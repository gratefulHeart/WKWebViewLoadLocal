!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TalqsTemplate=e()}(this,function(){"use strict";function t(t){return t.replace(m,"").replace(T,",").replace(y,"").replace(O,"").replace(E,"").split(A)}function e(t){return"'"+t.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function n(n,a){function i(t){return p+=t.split(/\n/).length-1,u&&(t=t.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),t&&(t=v[1]+e(t)+v[2]+"\n"),t}function o(e){var n=p;if(c?e=c(e,a):r&&(e=e.replace(/\n/g,function(){return"$line="+ ++p+";"})),0===e.indexOf("=")){var i=d&&!/^=[=#]/.test(e);if(e=e.replace(/^=[=#]?|[\s;]*$/g,""),i){var o=e.replace(/\s*\([^\)]+\)/,"");_[o]||/^(include|print)$/.test(o)||(e="$escape("+e+")")}else e="$string("+e+")";e=v[1]+e+v[2]}return r&&(e="$line="+n+";"+e),g(t(e),function(t){if(t&&!f[t]){var e;e="print"===t?T:"include"===t?y:_[t]?"$utils."+t:I[t]?"$helpers."+t:"$data."+t,O+=t+"="+e+",",f[t]=!0}}),e+"\n"}var r=a.debug,l=a.openTag,s=a.closeTag,c=a.parser,u=a.compress,d=a.escape,p=1,f={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},h="".trim,v=h?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],m=h?"$out+=text;return $out;":"$out.push(text);",T="function(){var text=''.concat.apply('',arguments);"+m+"}",y="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+m+"}",O="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(r?"$line=0,":""),E=v[0],A="return new String("+v[3]+");";g(n.split(l),function(t){t=t.split(s);var e=t[0],n=t[1];1===t.length?E+=i(e):(E+=o(e),n&&(E+=i(n)))});var C=O+E+A;r&&(C="try{"+C+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+e(n)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var L=new Function("$data","$filename",C);return L.prototype=_,L}catch(t){throw t.temp="function anonymous($data,$filename) {"+C+"}",t}}var a=function(t,e){return"string"==typeof e?h(e,{filename:t}):r(t,e)};a.version="3.0.0",a.config=function(t,e){i[t]=e};var i=a.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},o=a.cache={};a.render=function(t,e){return h(t)(e)};var r=a.renderFile=function(t,e){var n=a.get(t)||f({filename:t,name:"Render Error",message:"Template not found"});return e?n(e):n};a.get=function(t){var e;if(o[t])e=o[t];else if("object"==typeof document){var n=document.getElementById(t);if(n){var a=(n.value||n.innerHTML).replace(/^\s*|\s*$/g,"");e=h(a,{filename:t})}}return e};var l=function(t,e){return"string"!=typeof t&&(e=typeof t,"number"===e?t+="":t="function"===e?l(t.call(t)):""),t},s={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},c=function(t){return s[t]},u=function(t){return l(t).replace(/&(?![\w#]+;)|[<>"']/g,c)},d=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},p=function(t,e){var n,a;if(d(t))for(n=0,a=t.length;n<a;n++)e.call(t,t[n],n,t);else for(n in t)e.call(t,t[n],n)},_=a.utils={$helpers:{},$include:r,$string:l,$escape:u,$each:p};a.helper=function(t,e){I[t]=e};var I=a.helpers=_.$helpers;a.onerror=function(t){var e="Template Error\n\n";for(var n in t)e+="<"+n+">\n"+t[n]+"\n\n";"object"==typeof console&&console.error(e)};var f=function(t){return a.onerror(t),function(){return"{Template Error}"}},h=a.compile=function(t,e){function a(n){try{return new s(n,l)+""}catch(a){return e.debug?f(a)():(e.debug=!0,h(t,e)(n))}}e=e||{};for(var r in i)void 0===e[r]&&(e[r]=i[r]);var l=e.filename;try{var s=n(t,e)}catch(t){return t.filename=l||"anonymous",t.name="Syntax Error",f(t)}return a.prototype=s.prototype,a.toString=function(){return s.toString()},l&&e.cache&&(o[l]=a),a},g=_.$each,v="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",m=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,T=/[^\w$]+/g,y=new RegExp(["\\b"+v.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),O=/^\d[^,]*|,\d[^,]*/g,E=/^,+|,+$/g,A=/^$|,+/;i.openTag="{{",i.closeTag="}}";var C=function(t,e){var n=e.split(":"),a=n.shift(),i=n.join(":")||"";return i&&(i=", "+i),"$helpers."+a+"("+t+i+")"};i.parser=function(t,e){t=t.replace(/^\s/,"");var n=t.split(" "),i=n.shift(),o=n.join(" ");switch(i){case"if":t="if("+o+"){";break;case"else":n="if"===n.shift()?" if("+n.join(" ")+")":"",t="}else"+n+"{";break;case"/if":t="}";break;case"each":var r=n[0]||"$data",l=n[1]||"as",s=n[2]||"$value",c=n[3]||"$index",u=s+","+c;"as"!==l&&(r="[]"),t="$each("+r+",function("+u+"){";break;case"/each":t="});";break;case"echo":t="print("+o+");";break;case"print":case"include":t=i+"("+n.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(o)){var d=!0;0===t.indexOf("#")&&(t=t.substr(1),d=!1);for(var p=0,_=t.split("|"),I=_.length,f=_[p++];p<I;p++)f=C(f,_[p]);t=(d?"=":"=#")+f}else t=a.helpers[i]?"=#"+i+"("+n.join(",")+");":"="+t}return t};var L={Question:"question",StemsWrapper:"stemsWrapper",ChildQSAnalyze:"childQSAnalyzeWrapper",AnalyzeWrapper:"analyzeWrapper",Index:"questionIndex",Source:"questionSource",Difficulty:"questionDifficulty",Content:"questionContent",Options:"questionOptions",ChildList:"questionChildList",Answer:"questionAnswer",AnswerItem:"questionAnswerItem",Analyze:"questionAnalyze",AnalyzeItem:"questionAnalyzeItem",KnowledgePoint:"questionKnowledgePoint",KnowledgePointItem:"questionKnowledgePointItem",QueID:"questionID"},N={};N[L.Question]=[L.StemsWrapper,L.AnalyzeWrapper],N[L.StemsWrapper]=[L.Index,L.Source,L.Difficulty,L.Content,L.Options,L.ChildList,L.ChildQSAnalyze],N[L.AnalyzeWrapper]=[L.Answer,L.Analyze,L.KnowledgePoint,L.QueID],N[L.ChildQSAnalyze]=[L.Answer,L.Analyze,L.KnowledgePoint,L.QueID];var b={answer:"答案",analyze:"解析",queId:"ID",knowledgePoint:"知识点",label:"标签"},q="talqs",S="talqs_options",R={main:q,options:S,stems:"talqs_main",subqs:"talqs_subqs",content:"talqs_content",difficulty:"talqs_difficulty",index:"talqs_index",source:"talqs_source",knowledgePoint:"talqs_knowledge_point",id:"talqs_id",analyzeItem:"talqs_analyze_item",analyzeItemIndex:"talqs_analyze_item_index",panelItem:"talqs_panel_item",panelItemContent:"talqs_panel_item_content",panelItemIndex:"talqs_panel_item_index",answer:"talqs_answer",analyze:"talqs_analyze",analyzeGroup:"talqs_analyze_group",analyzeLayer:"talqs_analyze_layer",analyzeSingle:"talqs_analyze_single",optionsList:S+"_list",optionsRows:S+"_rows",optionsColumns:S+"_columns",optionsItem:S+"_columns_item",optionsIndex:S+"_index",optionsLabel:S+"_label",optionsContent:S+"_content",layoutComplete:"talqs_layout_complete",label:"talqs_label",panel:"talqs_panel",tree:"talqs_tree",clear:"clearfix"},P={analyzeVersion:0,hideSource:!1,hideDifficulty:!1,templates:N,labels:b,queIndex:0,entryTemplate:L.Question,autoLayoutHook:'[data-auto-layout="1"]',layoutClassName:R.optionsList,layoutCompleteClassName:R.layoutComplete,components:L,showMultiAnswer:!0,separator:{0:[" ; "," 或 "]}},D={};D.json=function(t){return JSON.stringify(t)},D.formatDifficulty=function(t,e){t=parseInt(t,10)||0;for(var n="",a=0;a<t;a++)n+=e;return n},D.formatAnswer=function(t,e){var n="";if(Array.isArray(t)){var a=t.length,i=parseInt(e.type,10)||0,o=parseInt(e.subjectId,10)||0,r=e.separator[o],l=e.showMulti,s=r[0],c=r[1];switch(i){case 4:case 8:t.forEach(function(t,e){Array.isArray(t)?n+=t.length>1&&l?t.join(c):t[0]:n+=t,e<a-1&&(n+=s)});break;case 10:for(var u=0;u<a;u++)u%5==0&&u>0&&(n+=" "),n+=t[u];break;default:n=t.join("")}}return n};var H,w='<div class="'+R.main+'" data-talqs-root="{{data.queId}}">\n  {{ each config.templates[\''+L.Question+"'] }}\n    {{include $value}}\n  {{/each}}\n</div>\n",x='\n<div class="'+R.stems+" "+R.clear+"\">\n {{each config.templates['"+L.StemsWrapper+"']}}\n    {{include $value}}\n {{/each}}\n</div>\n",G='\n  {{if config.analyzeVersion === 2}}\n     <div class="'+R.analyzeGroup+'">\n      <div class="'+R.analyzeLayer+"\">\n        {{ each config.templates['"+L.AnalyzeWrapper+"'] }}\n          {{include $value}}\n        {{/each}}\n      </div>\n    </div>\n  {{/if}}\n",k='\n{{if index && index > 0}}\n  <span class="'+R.index+'">{{index}}</span>\n{{/if}}\n',M='\n{{if !isSub && !config.hideSource}}\n  <div class="'+R.source+'">\n    {{data.queSource}}\n  </div>\n{{/if}}\n',$='\n{{if data.content && !data.hideContent}}\n  <div class="'+R.content+" "+R.clear+'">{{#data.content}}</div>\n{{/if}}\n',Q='\n{{ if data.answerOptionList && data.answerOptionList.length }}\n  <div class="'+R.options+" "+R.clear+'">\n    <ul class="'+R.optionsList+'" data-auto-layout="{{data.answerOptionList[0].length}}">\n      {{each data.answerOptionList}}\n        <li class="'+R.optionsRows+" "+R.clear+'">\n          {{if data.isCloze}}\n            <span class="'+R.optionsIndex+'">{{$index+1}}. </span>\n          {{/if}}\n          <ul class="'+R.optionsColumns+"_{{$value.length}} "+R.clear+'">\n            {{each $value}}\n              <li class="'+R.optionsItem+" "+R.clear+'">\n                <span class="'+R.optionsLabel+'">{{$value.aoVal}}. </span>\n                <div class="'+R.optionsContent+'">{{#$value.content}}</div>\n              </li>\n            {{/each}}\n          </ul>\n        </li>\n      {{/each}}\n    </ul>\n  </div>\n{{/if}}\n',z='\n{{if !isSub && !config.hideDifficulty}}\n  <div class="'+R.difficulty+"\">\n    {{#data.difficulty | formatDifficulty:'<span>&#9733;</span>'}}\n  </div>\n{{/if}}\n",B='\n{{ if data.childList }}\n  <div class="'+R.subqs+"\">\n    {{each data.childList}}\n      {{include '"+L.StemsWrapper+"' {data:$value,config:config,index:$index+1,isSub:true} ''}}\n    {{/each}}\n  </div>\n{{/if}}\n",W='\n{{if isSub && config.analyzeVersion === 1 && !data.childList }}\n   <div class="'+R.analyzeSingle+"\">\n    {{ each config.templates['"+L.ChildQSAnalyze+"'] }}\n      {{include $value}}\n    {{/each}}\n  </div>\n{{/if}}\n",U='\n<div class="'+R.answer+"  "+R.clear+'">\n  <label class="'+R.label+'">\n    {{config.labels.answer}}\n  </label>\n  <div class="'+R.panel+"\">\n    {{include '"+L.AnswerItem+"'}}\n  </div>\n</div>\n",K='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+R.analyzeItem+'">\n      <div class="'+R.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+L.AnswerItem+"' {data:$value,config:config} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+R.panelItem+'">\n    <div class="'+R.panelItemContent+'">\n        {{#data.answer | formatAnswer:{type:data.logicQuesTypeId,subject:data.subjectId,separator:config.separator,showMulti:config.showMultiAnswer} }}\n    </div>\n  </div>\n{{/if}}\n',Y='\n<div class="'+R.analyze+"  "+R.clear+'">\n  <label class="'+R.label+'">\n    {{config.labels.analyze}}\n  </label>\n  <div class="'+R.panel+"\">\n    {{include '"+L.AnalyzeItem+"'}}\n  </div>\n</div>\n",F='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+R.analyzeItem+'">\n      <div class="'+R.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+L.AnalyzeItem+"' {data:$value} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+R.panelItem+'">\n    {{each data.analysis }}\n      {{if data.analysis.length > 1}}\n        <span class="'+R.panelItemIndex+'">{{$index+1}}.</span>\n      {{/if}}\n      <div class="'+R.panelItemContent+'">\n        {{#$value}}\n      </div>\n    {{/each}}\n  </div>\n{{/if}}\n',j='\n <div class="'+R.knowledgePoint+"  "+R.clear+'">\n  <label class="'+R.label+'">\n    {{config.labels.knowledgePoint}}\n  </label>\n  <div class="'+R.tree+"\">\n    <ul>\n      {{each data.examOptionList}}\n        {{include '"+L.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  </div>\n</div>\n",V="\n<li>\n  {{data.name}}\n  {{if data.childList}}\n    <ul>\n      {{each data.childList}}\n        {{include '"+L.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  {{/if}}\n</li>\n",X='\n<div class="'+R.id+"  "+R.clear+'">\n  <label class="'+R.label+'">\n    {{config.labels.queId}}\n  </label>\n  <div class="'+R.panel+'">\n    {{data.queId}}  \n  </div>\n</div>\n',Z=(H={},H[L.Question]=w,H[L.StemsWrapper]=x,H[L.AnalyzeWrapper]=G,H[L.ChildQSAnalyze]=W,H[L.Index]=k,H[L.Source]=M,H[L.Content]=$,H[L.Options]=Q,H[L.Difficulty]=z,H[L.ChildList]=B,H[L.Answer]=U,H[L.AnswerItem]=K,H[L.Analyze]=Y,H[L.AnalyzeItem]=F,H[L.KnowledgePoint]=j,H[L.KnowledgePointItem]=V,H[L.QueID]=X,H),J=function(t){throw new Error(t)},tt={InvalidQS:"Expect an object"},et={version:"1.0.0",config:P,get components(){return this.config.components}},nt=Object.assign||function(t,e){var n=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(t),i=1;i<arguments.length;i++){var o=n[i];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(a[r]=o[r])}return a},at=function(t){return t&&"object"==typeof t};et.render=function(t,e){if(!t||!at(t))return J(tt.InvalidQS);e=e||{};for(var n in P){var i=P[n];if(void 0===e[n])e[n]=i;else{var o=e[n];at(o)&&(e[n]=nt({},i,o))}}return et.config=e,(0,a.cache[e.entryTemplate])({config:e,data:t,index:e.queIndex})},et.renderPartialComponent=function(t,e){if(!e||!at(e))return J(tt.InvalidQS);var n=et.config,i=a.cache[t];return i&&i({config:n,data:e})};var it=function(t,e){a.helper(t,e)};et.registerHelper=it;for(var ot in D)it(ot,D[ot]);var rt=function(t){for(var e in t){var n=t[e].replace(/^\s*|\s*$/g,""),i=a.compile(n,{filename:e});a.cache[e]=i}};rt(Z);var lt=function(t){var e=et.config.templates;for(var n in t)!function(n){var a=t[n],i=e[n]||[];a.exclude&&a.exclude.length&&i.length&&(i=i.filter(function(t){return-1===a.exclude.indexOf(t)}));var o={};if(a.template&&(o[n]=a.template),a.components&&a.components.length){var r=void 0,l=void 0;a.components.forEach(function(t){if(r=t.name,(l=i.indexOf(r))<0){var e=isNaN(t.index)?i.length:t.index;i.splice(e,0,r)}else isNaN(t.index)||(i.splice(l,1),i.splice(t.index,0,r));o[r]=t.template})}Object.keys(o).length&&rt(o),et.config.templates[n]=i.filter(function(t){return"string"==typeof t})}(n)};return et.updateTemplateList=lt,et.autoLayout=function(t){var e=et.config.autoLayoutHook,n=document.querySelectorAll(e);if(n&&n.length){var a=et.config.layoutCompleteClassName;n=Array.prototype.slice.apply(n),n.forEach(function(e){var n=t||Math.floor(e.offsetWidth);e.style.display="inline-block";var i=e.children.length,o=Math.ceil(e.offsetWidth+10),r=1;if(o){r=i<=Math.floor(n/o)?i:o>=n/2?1:o>=n/4?2:4}var l=et.config.layoutClassName+"_",s=new RegExp(l+"\\d","g");e.className=e.className.replace(s,""),e.classList.add(l+r),e.classList.add(a),e.style.display=""})}},et.resetComponent=function(){var t=Array.prototype.slice.call(arguments),e={};t.length?t.forEach(function(t){var n=Z[t];n&&(e[t]=n)}):e=Z,rt(e)},et}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TalqsInteraction=e()}(this,function(){"use strict";function t(t){return t=f(t),t=g(t)}function e(t){return t=f(t),t.split(" ").length}function n(t){var e=""+t,n=A.exec(e);if(!n)return e;var a,i="",o=0,r=0;for(o=n.index;o<e.length;o++){switch(e.charCodeAt(o)){case 34:a="&quot;";break;case 38:a="&amp;";break;case 39:a="&#39;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}r!==o&&(i+=e.substring(r,o)),r=o+1,i+=a}return r!==o?i+e.substring(r,o):i}var a=function(){var t=function(){this._cache={}},e={cache:{}};return e.cache.get=function(){return this._cache},t.prototype.set=function(t,e){this._cache[t]=e},t.prototype.get=function(t){var e=this,n=[];for(var a in e._cache){var i=e._cache[a];if(t){if(a===t){n.push(i);break}i.rootId===t&&n.push(i)}else n.push(i)}return n.length?n:void 0},t.prototype.remove=function(t){delete this._cache[t]},Object.defineProperties(t.prototype,e),new t}(),i={CHANGE:"TALQS_INTERACTION_CHANGE",TOGGLE_INTEACTION:"TALQS_INTERACTION_TOGGLE_INTEACTION"},o=function(t){var e=F.onChange;e&&"function"==typeof e&&e({data:t})},r=/(?:&nbsp;)*<(?:u|span\s[^>]+)>(?:&nbsp;|\s){3,}(\d*)(?:&nbsp;|\s){3,}<\/(?:u|span)>(?:&nbsp;)*/g,l=/[^\s\w\u4e00-\u9fa5,.\/<>?:;'"`~!@#$%^&*()-_+={}\[\]|，。、《》？；：’‘“”·~！￥……（）——【】]/g,s=/(<(?:td|span) [^>]*\bneedFill\b[^>]*">)[^<]*(<\/(?:td|span)>)/g,c=/<talqs-blank ([^>]*)>/g,u=/(<img[^>]*>)/g,d={app:"talqs-app",rootId:"data-talqs-root",type:"data-talqs-type",queId:"data-que-id",logicType:"data-logic-type",optionList:"option-list-root",autoLayout:"data-auto-layout",optionGroup:"data-option-group",optionItem:"data-option-item",optionContent:"data-option-content",optionIndex:"data-option-index",optionAnalyze:"data-option-analyze",anchor:"data-anchor-item",blankItem:"data-blank-item",inputid:"data-inputid",dragItem:"data-talqs-drag-item",dragContainer:"data-talqs-drag-container",currentOption:"data-current-option",currentIndex:"data-current-index",sortLineContainer:"sort-line-container",sortLine:"sort-line",sortWord:"data-sort-word",sortItem:"sort-item",tofv:"data-true-flase",matchItem:"data-match-item",matchContainer:"data-match-container"},p="talqs_options",_={content:"talqs_content",stems:"talqs_main",options:p,optionsList:p+"_list",optionsRows:p+"_rows",optionsColumns:p+"_columns",optionsItem:p+"_columns_item",optionsIndex:p+"_index",optionsLabel:p+"_label",optionsContent:p+"_content",optionWrapper:p+"_analyze",optionAnalyze:p+"_analyze_group",analyzeContainer:"talqs_analysis_container",clear:"clearfix",hidden:"hidden",input:"talqs_blank_input",inputShadow:"talqs_input_shadow",label:"talqs_label",panel:"talqs_panel",sortLineContainer:"talqs_line_cont",sortLine:"talqs_word_line",sortWord:"talqs_word_btn",sortPlaceHolder:"sortable-placeholder",dnd:"talqs_dnd_container",dndShort:"talqs_dnd_container_short",dndLong:"talqs_dnd_container_long",anchor:"talqs_anchor_container",sentence:"sentence_type",tfText:p+"_tf_text",optionMatch:p+"_match",dropActive:"talqs_drop_highlight",dropHover:"talqs_drop_hover",active:"talqs_active",wrong:"talqs_wrong",right:"talqs_right",enable:"talqs_enable",disable:"talqs_disable",mathInput:"talqs_math_input",imgsContainer:"talqs_img_container",imgLoader:"talqs_img_loader"},I=/<[^>]+>/g,f=function(t){return(t||"").replace(I,"")},h=/&[\w#]+;/g,g=function(t){return(t||"").replace(h,"")},v=function(t){var n;return t&&t.length&&(n=0,t.forEach(function(t){n+=e(t[0].content)}),n=Math.ceil(n/t.length)),n},m={1:"choice",2:"choice",3:"dragCloze",4:"fillblank",5:"choice",6:"dragMatch",7:"dragSort",10:"choice",13:"dragSort"},T={3:"talqs_main_dnd_5",5:"talqs_main_tf",6:"talqs_main_match",9:"talqs_main_read",10:"talqs_main_fill",13:"talqs_word_sentence"},y={1:"chinese",2:"math",3:"english",4:"physics",5:"chemistry",6:"biology",8:"history",9:"geography",10:"politics"},O=function(t){var e=parseInt(t.logicQuesTypeId,10);return m[e]||""},E=function(e){var n=parseInt(e.logicQuesTypeId,10),a=parseInt(e.subjectId,10),i=T[n]||"";if(3==a){if(3===n){var o=v(e.answerOptionList),r=o>3;i=" talqs_main_dnd_"+(r?5:7)+" ",i+=r?"sentence_type":""}9===n&&t(e.content).length<400&&(i="")}else 9===n&&(i="");return i+=" subject_"+(y[a]||"")},A=/["'&<>]/,C={},L=function(t,e){t=t.replace(r,'<talqs-blank type="text" autocomplete="off"  autocapitalize="none" maxlength="100">'),t=t.replace(s,'$1<talqs-blank type="number">$2');var n,a=-1;return t.replace(c,function(t,i){return a++,n=e?'<span class="'+_.mathInput+'" '+d.blankItem+'="'+a+'"></span>':" <input "+i+' autocorrect="off" '+d.blankItem+'="'+a+'" class="'+_.input+'"> '})},N=function(t){var e=-1;return t.replace(r,function(t){return e++,"<u "+d.dragContainer+'="'+e+'" class="'+_.dnd+'">'+b("",150)+"</u>"})},b=function(t,e){for(var n=t||"",a=e-n.length,i=a;i>=0;i--)n+=" ";return n},q=function(t){return t=(t||"").replace(u,'<span class="'+_.imgLoader+'">$1<span></span></span>')};C.wrapperImage=q;var S=function(t,e){var n=-1;return t.replace(r,function(t){return" "+(++n+1)+'.<a href="#'+d.optionGroup+e+n+'" class="'+_.anchor+'">'+b("",30)+"</a>"})};C.transfromBlankContent=function(t,e){var n=parseInt(e.logicQuesTypeId,10),a=t;switch(n){case 3:a=N(t);break;case 4:var i=1==e.isDecidable&&1==e.keyboardType;a=L(t,i);break;case 10:a=S(t,e.queId)}return a=q(a)},C.escapeHtml=n,C.transContentToList=function(t,e){return t&&t.split(e)},C.renderList=function(t,e){return t.map(function(t,a){return e.replace(/\$\[value\]/g,n(t))}).join(" ")},C.getInteractiveType=O,C.getStyle=E;var R=(function(t){var e={CLICK_DATA_API:"click.talqs.choice.data-api"},n={ROOT_QS_CONTAINER:"["+d.rootId+"]",CHOICE_TYPE:"["+d.type+'="choice"]',CHOICE_GROUP:"["+d.optionGroup+"]",CHOICE_ITEM:"["+d.optionItem+"]",CHOICE_CONTENT:"["+d.optionContent+"]",CHOICE_ITEM_ANCHOR:'[href^="#'+d.optionGroup+'"]'},r={ROOT_QS_ID:d.rootId,QUE_ID:d.queId,LOGIC_TYPE:d.logicType,CHOICE_GROUP:d.optionGroup,CHOICE_ITEM:d.optionItem,CHOICE_INDEX:d.optionIndex,CHOICE_CONTENT:d.optionContent},l={ACTIVE:_.active,WRONG:_.wrong,RIGHT:_.right,DISABLE:_.disable,HIGHLIGHT:_.dropHover},s=function(t,e,n,a,i){this._queId=t,this._rootId=e,this._element=n,this._config=i,this._childrenList=null,this._childrenAnchor=null,this._selected=a||[],this._result=[]},c={VERSION:{}};c.VERSION.get=function(){return"1.0.0"},s.prototype._getChildrenList=function(){return this._childrenList?this._childrenList:this._element.querySelectorAll(n.CHOICE_GROUP)},s.prototype._updateResultState=function(t,e,n){t.classList.toggle(l.WRONG,e),t.classList.toggle(l.RIGHT,n)},s.prototype._updateItemStyle=function(t,e,a,i){var o=this,s=a?this._selected[e]:this._selected,c=a?this._result[e]:this._result[0],u=1===c,d=0===c,p=void 0===c||""===c;i&&this._updateResultState(t.children[0],d,u);var _=t.querySelectorAll(n.CHOICE_ITEM);[].forEach.call(_,function(t){var e=t.getAttribute(r.CHOICE_ITEM),n=e===s;Array.isArray(s)&&(n=!(s.indexOf(e)<0)),i||o._updateResultState(t,n&&d,n&&u),t.classList.toggle(l.ACTIVE,n&&(p||i))})},s.prototype._updateStyleState=function(t){var e=this,n=this._getChildrenList(),a=this._config.multiAnswer,i=this._config.trueorfalse;!isNaN(t)&&a?this._updateItemStyle(n[t],t,a,i):[].forEach.call(n,function(t,n){e._updateItemStyle(t,n,a,i)})},s.prototype._updateBlankFill=function(t,e){if(this._childrenAnchor||(this._childrenAnchor=this._element.querySelectorAll(n.CHOICE_ITEM_ANCHOR)),this._childrenAnchor.length)if(isNaN(t)){var a=this._selected;[].forEach.call(this._childrenAnchor,function(t,e){var i=a[e];if(i){var o=document.querySelector(t.getAttribute("href")),l=o.querySelector("["+r.CHOICE_ITEM+'="'+i+'"]'),s=l.querySelector(n.CHOICE_CONTENT);t.innerText=b(s.innerText,30)}else t.innerText=b("",30)})}else{var i=this._childrenAnchor[t];i.innerText=b(e||"",30),i.classList.remove(l.HIGHLIGHT)}},s.prototype.updateSelectedState=function(t){var e=this,n=t.option,i=parseInt(t.index,10);if(this._config.multiAnswer){if(this._selected[i]===n)return;this._selected[i]=n;for(var r=this._getChildrenList().length||0,l=0;l<r;l++)e._selected[l]=e._selected[l]||"";this._updateBlankFill(i,t.content)}else{var s=this._selected.indexOf(n);if(this._config.multipleChoice)s<0?this._selected.push(n):this._selected.splice(s,1);else{if(-1!==s)return;this._selected=[n]}this._selected.sort()}this._updateStyleState(i);var c={rootId:this._rootId,queId:this._queId,data:this._selected,type:this._config.type};a.set(this._queId,c),o(c)},s.prototype.fillDataIntoComponent=function(t){this._selected=t.data||[],this._result=t.result||[],this._updateStyleState(),this._config.clozeChoice&&this._updateBlankFill()},s._getInstance=function(e,n,a){var i=t(a).data("talqs.choice");return i||(i=new s(e,n,a,[],s._getConfig(a)),t(a).data("talqs.choice",i)),i},s._getRootId=function(e){var a=t(e).closest(n.ROOT_QS_CONTAINER)[0];return a&&a.getAttribute(r.ROOT_QS_ID)},s._getQueId=function(t){return t&&t.getAttribute(r.QUE_ID)},s._getConfig=function(t){var e=t.getAttribute(r.LOGIC_TYPE);return e=parseInt(e,10),{type:e,multipleChoice:2===e,clozeChoice:10===e,multiAnswer:10===e||5===e,trueorfalse:5===e}},s._dataApiClickHandler=function(){if(F.isInteractive){var e=t(this).closest(n.CHOICE_GROUP)[0];if(!([].indexOf.call(e.classList,l.DISABLE)>=0)){var a=t(this).closest(n.CHOICE_TYPE)[0],i=s._getQueId(a),o=s._getRootId(this),c=this.querySelector(n.CHOICE_CONTENT);if(i&&o){var u={option:this.getAttribute(r.CHOICE_ITEM),content:c&&c.innerText,index:e.getAttribute(r.CHOICE_GROUP)};s._getInstance(i,o,a).updateSelectedState(u)}}}},s._dataInitialHandler=function(){var t=document.querySelectorAll(n.CHOICE_TYPE);[].forEach.call(t,function(t){var e=s._getQueId(t),n=s._getRootId(t),i=e&&a.cache[e];n&&i&&s._getInstance(e,n,t).fillDataIntoComponent(i)})},s._toggleInteractionHandler=function(t){(t.data||[]).forEach(function(t){var e=document.querySelector(n.CHOICE_TYPE+"["+r.QUE_ID+'="'+t.queId+'"]');if(e){var a=e.querySelectorAll(n.CHOICE_GROUP),i=s._getConfig(e);[].forEach.call(a,function(e,n){var a=i.multiAnswer?n:0;e.classList.toggle(l.DISABLE,1===t.rectifyState[a])})}})},s._updateHighLightStateHandler=function(t){var e=document.querySelectorAll(n.CHOICE_ITEM_ANCHOR),a=this;[].forEach.call(e,function(t){t.classList.toggle(l.HIGHLIGHT,t===a)})},Object.defineProperties(s,c),t(document).on(e.CLICK_DATA_API,n.CHOICE_TYPE+" "+n.CHOICE_ITEM,s._dataApiClickHandler),t(document).on(e.CLICK_DATA_API,n.CHOICE_TYPE+" "+n.CHOICE_ITEM_ANCHOR,s._updateHighLightStateHandler),t(document).on(i.CHANGE,s._dataInitialHandler),document.addEventListener(i.TOGGLE_INTEACTION,s._toggleInteractionHandler)}(jQuery),function(){this._inputList=[],this._keypad=null,this._currentField=null}),P={list:{},keypad:{},currentField:{}};P.list.get=function(){return this._inputList},R.prototype.putList=function(t){this._inputList.push(t)},P.keypad.set=function(t){this._keypad=t},P.keypad.get=function(){return this._keypad},P.currentField.set=function(t){this._currentField=t},P.currentField.get=function(){return this._currentField},R.prototype.resetCursor=function(t){this._inputList.length&&this._inputList.forEach(function(t){t&&t.focused&&t.blur()}),this.currentField=t},Object.defineProperties(R.prototype,P);var D=(function(t){var e=new R,n={BLUR_DATA_API:"blur.talqs.fillblank.data-api",KEYUP_DATA_API:"keyup.talqs.fillblank.data-api",CLICK_API:"click.talqs.fillblank.data-api"},r={APP_CONTAINER:"["+d.app+"]",ROOT_QS_CONTAINER:"["+d.rootId+"]",FILL_BLANK_TYPE:"["+d.type+'="fillblank"]',FILL_BLANK_ITEM:"["+d.blankItem+"]",MATH_INPUT_ITEM:"."+_.mathInput,MAIN_CONTENT:".talqs_main",MATH_KEYPAD:".keypad"},s={ROOT_QS_ID:d.rootId,QUE_ID:d.queId,FILL_BLANK_ITEM:d.blankItem,LOGIC_TYPE:d.logicType},c={WRONG:_.wrong,RIGHT:_.right,SHADOW:_.inputShadow,MATH_INPUT:_.mathInput},u=function(t,e,n,a){this._queId=t,this._rootId=e,this._element=n,this._blankData=a||[],this._num=0},p={VERSION:{}};p.VERSION.get=function(){return"1.0.0"},u.prototype.updateBlankValueByIndex=function(t,e){var n=this;if(t=parseInt(t,10),!isNaN(t)){if(this._blankData[t]!==e){this._blankData[t]=e,this._num||(this._num=u._getBlankItemList(this._element).length||0);for(var i=[],r=0;r<this._num;r++)i.push(n._blankData[r]||"");this._logicType||(this._logicType=parseInt(this._element.getAttribute(s.LOGIC_TYPE),10));var l={queId:this._queId,rootId:this._rootId,data:i,type:this._logicType};a.set(this._queId,l),o(l)}}},u.prototype.fillDataIntoComponent=function(t){var e=t.data||[],n=t.result||[];this._blankData=e;var a=u._getBlankItemList(this._element);a&&[].forEach.call(a,function(e,a){var i=t.data[a]||"";e.className.indexOf(c.MATH_INPUT)>=0?(e.mathInput?e.mathInput.value=i:u._initMathInput(e,i),e.mathInput.focused&&u.toggleKeypad(!1,e.mathInput)):(e.value=i,e.style.width=u._getInputWidth(i)),e.classList.toggle(c.WRONG,0===n[a]),e.classList.toggle(c.RIGHT,1===n[a])})},u._getInputWidth=function(t){var e=document.querySelector("."+c.SHADOW);e||(e=document.createElement("span"),e.classList.add(c.SHADOW),document.body.appendChild(e)),e.innerText=t;var n=e.offsetWidth+"px";return e.innerText="",e.parentNode.removeChild(e),n},u._dataApiInputHandler=function(t){var e=t.target.value;u._updateInputDataHandler(this,e)},u._dynamicInputHandler=function(t){var e=t.target.value.trim();e=e.replace(l,""),t.target.value=e,t.target.style.width=u._getInputWidth(e)},u._updateInputDataHandler=function(e,n){var a=t(e).closest(r.FILL_BLANK_TYPE)[0],i=a&&a.getAttribute(s.QUE_ID),o=u._getRootId(e);if(i&&o){var l=e.getAttribute(s.FILL_BLANK_ITEM);u._getInstance(i,o,a).updateBlankValueByIndex(l,n)}},u._getInstance=function(e,n,a){var i=t(a).data("talqs.fillblank");return i||(i=new u(e,n,a,[]),t(a).data("talqs.fillblank",i)),i},u._getRootId=function(e){var n=t(e).closest(r.ROOT_QS_CONTAINER)[0];return n&&n.getAttribute(s.ROOT_QS_ID)},u._getBlankItemList=function(t){return t.querySelectorAll(r.FILL_BLANK_ITEM)},u._dataInitialHandler=function(){var t=document.querySelectorAll(r.FILL_BLANK_TYPE);[].forEach.call(t,function(t){var e=t.getAttribute(s.QUE_ID),n=u._getRootId(t),i=e&&a.cache[e];n&&i&&u._getInstance(e,n,t).fillDataIntoComponent(i)})},u._toggleInteractionHandler=function(t){(t.data||[]).forEach(function(t){var e=document.querySelector(r.FILL_BLANK_TYPE+"["+s.QUE_ID+'="'+t.queId+'"]');if(e){var n=u._getBlankItemList(e);[].forEach.call(n,function(e,n){var a=1===t.rectifyState[n];e.mathInput&&(e.disabled=a,e.mathInput.disabled=a,e.mathInput.focused&&u.toggleKeypad(!1,e.mathInput)),a?e.setAttribute("disabled",!0):e.removeAttribute("disabled")})}})},u.toggleKeypad=function(t,n){t||(e.resetCursor(),e.currentField=null);var a=e.keypadEle;a&&(a.style.transform=a.style.webkitTransform="translate3d(0, "+(t?"-25px":"100%")+", 0)")},u._initMathPad=function(){var t=document.querySelector(r.MATH_KEYPAD);e.keypadEle=t,e.keypad=new TalqsMathKeypad(t,{press:function(t,n){e.currentField&&e.currentField.pressKey(t,n)},dismiss:function(){u.toggleKeypad(!1,e.currentField)}});var n=function(n){var a=n.target,i=e.currentField;if(!(t.contains(a)||i&&i.mathContainer.contains(a))){i&&i.blur();e.list.filter(function(t){return t.mathContainer.contains(a)})[0]||u.toggleKeypad(!1)}};window.addEventListener("touchstart",n)},u._initMathInput=function(t,n){var a=window.innerHeight,i=t.offsetTop,o=function(t){var e=document.getElementById("keypadblank");if(!e&&t&&(e=document.createElement("div"),e.id="keypadblank",document.querySelector(r.MAIN_CONTENT).appendChild(e),e.style.height="300px"),e){e.style.display=t?"block":"none";var n=t||i>a?Math.max(i-50,0):0;setTimeout(function(){document.querySelector(r.ROOT_QS_CONTAINER).scrollTop=n},100)}},l=new TalqsMathInput(t,{onBlur:function(){u._updateInputDataHandler(t,l.value),o(!1)},onFocus:function(){i+250>a&&o(!0)},onChange:function(){u._updateInputDataHandler(t,l.value)}});l.value=n,t.mathInput=l,e.putList(l)},u._mathInputHandler=function(t){this.disabled||this.getAttribute&&this.getAttribute("disabled")||(this.mathInput||u._initMathInput(this),e.keypad||u._initMathPad(),e.resetCursor(),e.currentField=this.mathInput,this.mathInput.focus(),u.toggleKeypad(!0))},Object.defineProperties(u,p);document.querySelector(r.APP_CONTAINER);t(document).on(n.BLUR_DATA_API,r.FILL_BLANK_TYPE+" "+r.FILL_BLANK_ITEM,u._dataApiInputHandler),t(document).on(n.KEYUP_DATA_API,r.FILL_BLANK_TYPE+" "+r.FILL_BLANK_ITEM,u._dynamicInputHandler),t(document).on(i.CHANGE,u._dataInitialHandler),t(document).on(n.CLICK_API,r.FILL_BLANK_TYPE+" "+r.MATH_INPUT_ITEM,u._mathInputHandler),document.addEventListener(i.TOGGLE_INTEACTION,u._toggleInteractionHandler)}(jQuery),function(t){var e={APP_CONTAINER:"["+d.app+"]",ROOT_QS_CONTAINER:"["+d.rootId+"]",DRAG_CLOZE_TYPE:"["+d.type+'="dragCloze"]',DRAGGABLE_ITEM:".talqs_options_label",DROPPABLE_ITEM:"["+d.dragContainer+"]",OPTION_CONTAINER:"."+_.optionWrapper,
OPTION_GROUP:"["+d.optionGroup+"]",OPTION_LIST:"["+d.optionList+"]",OPTION_ITEM:"."+_.optionsLabel,OPTION_CONTENT:"."+_.optionsContent},n={ROOT_QS_ID:d.rootId,QUE_ID:d.queId,LOGIC_TYPE:d.logicType,DROPPABLE_ITEM:d.dragContainer,OPTION_GROUP:d.optionGroup,OPTION_ITEM:d.optionItem,CURRENT_OPTION:d.currentOption,CURRENT_INDEX:d.currentIndex},r={DROP_HOVER:_.dropHover,WRONG:_.wrong,RIGHT:_.right,DISABLE:_.disable,DND_SHORT:_.dndShort,DND_LONG:_.dndLong,SENTENCE:_.sentence},l=function(t,e,n,a){this._queId=t,this._rootId=e,this._element=n,this._blankData=a||[],this._num=0};l.prototype.updateBlankValueByIndex=function(t,i){var r=this;if(t=parseInt(t,10),!isNaN(t)){if(this._blankData[t]!==i){this._blankData[t]=i,this._num||(this._num=this._element.querySelectorAll(e.DROPPABLE_ITEM).length),this._logicType||(this._logicType=parseInt(this._element.getAttribute(n.LOGIC_TYPE),10));for(var l=[],s=0;s<this._num;s++)l.push(r._blankData[s]||"");var c={queId:this._queId,rootId:this._rootId,data:l,type:this._logicType};a.set(this._queId,c),o(c)}}},l.prototype.initHandler=function(){var a=t(this._element).data("talqs.dragCloze"),i=this._element,o=document.body.offsetWidth-10,l=document.body.offsetHeight-10,c=function(){var n=i.querySelectorAll(e.DRAGGABLE_ITEM);t(n).draggable({addClasses:!1,appendTo:i,containment:i,helper:"clone",revert:"invalid",revertDuration:200,scroll:!0,opacity:.8,drag:function(t,e){(t.clientX<10||t.clientY<10||t.clientX>o||t.clientY>l)&&t.preventDefault()}})};c();var u=this._element.querySelector(e.OPTION_LIST);s=u.children[0];var d=function(t,a){var i=s.cloneNode(!0),o=i.querySelector(e.OPTION_GROUP);o.setAttribute(n.OPTION_GROUP,a.index);var r=o.querySelector("["+n.OPTION_ITEM+"]");r.setAttribute(n.OPTION_ITEM,a.option),r.querySelector(e.OPTION_ITEM).innerText=a.option,r.querySelector(e.OPTION_CONTENT).innerText=a.content;var l,u=t.querySelectorAll(e.OPTION_GROUP);[].forEach.call(u,function(t,e){var i=parseInt(t.getAttribute(n.OPTION_GROUP),10);!l&&i>a.index&&(l=t.parentNode)}),t.insertBefore(i,l),c()},p=function(t){var e=t.getAttribute(n.CURRENT_OPTION);if(e)return{content:t.innerText,option:e,index:parseInt(t.getAttribute(n.CURRENT_INDEX),10)}},_=function(i,o){if(F.isInteractive){var r=o.draggable[0];if(r){var l=t(r).closest(e.OPTION_GROUP)[0],s={option:l.querySelector(e.OPTION_ITEM).textContent,content:l.querySelector(e.OPTION_CONTENT).textContent,index:l.getAttribute(n.OPTION_GROUP)},c=this.getAttribute(n.DROPPABLE_ITEM);a.updateBlankValueByIndex(c,s.option);var _=p(this);_&&d(u,_),a.updateAttributeForItem(this,s),u.contains(l.parentNode)&&u.removeChild(l.parentNode)}}},I=this._element.querySelectorAll(e.DROPPABLE_ITEM);t(I).droppable({addClasses:!1,tolerance:"intersect",accept:e.DRAGGABLE_ITEM,drop:_,hoverClass:r.DROP_HOVER}),t(I).on("click",function(){if(F.isInteractive){if(!([].slice.call(this.classList).indexOf(r.DISABLE)>=0)){var t=p(this);if(t){var e=this.getAttribute(n.DROPPABLE_ITEM);a.updateBlankValueByIndex(e,""),a.updateAttributeForItem(this,null),d(u,t)}}}})},l.prototype.updateAttributeForItem=function(t,e){var a=-1!==this._element.className.indexOf(r.SENTENCE),i=b(e&&e.content||"",150);t.innerText=i,e?(t.setAttribute(n.CURRENT_OPTION,e.option),t.setAttribute(n.CURRENT_INDEX,e.index),t.classList.toggle(r.DND_SHORT,!a),t.classList.toggle(r.DND_LONG,a)):(t.removeAttribute(n.CURRENT_OPTION),t.removeAttribute(n.CURRENT_INDEX),t.classList.remove(r.DND_SHORT),t.classList.remove(r.DND_LONG))},l.prototype.fillDataIntoComponent=function(a){var i=this,o=a.data||[],l=a.result||[];this._blankData=o;var c=this._element.querySelectorAll(e.DROPPABLE_ITEM),u=this._element.querySelector(e.OPTION_LIST);s=u.children[0];for(var d=0,p=o.length,_=void 0,I=void 0,f=void 0;d<p;d++)_=o[d],f=c[d],t(f).trigger("click"),_&&(I=i._element.querySelector("["+n.OPTION_ITEM+'="'+_+'"]'))&&(i.updateAttributeForItem(f,{option:_,content:I.querySelector(e.OPTION_CONTENT).textContent,index:I.parentNode.getAttribute(n.OPTION_GROUP)}),u.removeChild(I.parentNode.parentNode)),f.classList.toggle(r.WRONG,0===l[d]),f.classList.toggle(r.RIGHT,1===l[d])},l._getInstance=function(e,n,a){var i=t(a).data("talqs.dragCloze");return i||(i=new l(e,n,a,[]),t(a).data("talqs.dragCloze",i)),i},l._instanceInitHandler=function(){var t=document.querySelectorAll(e.DRAG_CLOZE_TYPE);[].forEach.call(t,function(t){var e=t.getAttribute(n.QUE_ID),a=l._getRootId(t);e&&a&&l._getInstance(e,a,t).initHandler()})},l._getRootId=function(a){var i=t(a).closest(e.ROOT_QS_CONTAINER)[0];return i&&i.getAttribute(n.ROOT_QS_ID)},l._dataInitialHandler=function(){for(var t=document.querySelectorAll(e.DRAG_CLOZE_TYPE),i=t&&t.length||0,o=0;o<i;o++){var r=t[o],s=r.getAttribute(n.QUE_ID),c=l._getRootId(r),u=s&&a.cache[s];c&&u&&l._getInstance(s,c,r).fillDataIntoComponent(u)}},l._toggleInteractionHandler=function(a){(a.data||[]).forEach(function(a){var i=document.querySelector(e.DRAG_CLOZE_TYPE+"["+n.QUE_ID+'="'+a.queId+'"]');if(i){var o=t(i).find(e.DROPPABLE_ITEM);[].forEach.call(o,function(e,n){var i=1===a.rectifyState[n];e.classList.toggle(r.DISABLE,i),t(e).droppable(i?"disable":"enable")})}})};var s,c=document.querySelector(e.APP_CONTAINER),u=window.MutationObserver||window.WebKitMutationObserver,p=new u(l._instanceInitHandler);c&&p.observe(c,{childList:!0,attributes:!0}),t(document).on(i.CHANGE,l._dataInitialHandler),document.addEventListener(i.TOGGLE_INTEACTION,l._toggleInteractionHandler)}(jQuery),function(t){var e={CLICK_DATA_API:"click.talqs.dragSort.data-api"},n="["+d.type+"=dragSort]",r={ROOT_QS_CONTAINER:"["+d.rootId+"]",DRAG_SORT_TYPE:n,SORT_LINE_CONT:"["+d.sortLineContainer+"]",SORT_LINE:"["+d.sortLine+"]",SORT_WORD:"["+d.sortWord+"]",SORT_OPTION_LIST:"["+d.optionList+"]",SORT_OPTION_ITEM:n+" ["+d.sortItem+"]"},l={ROOT_QS_ID:d.rootId,QUE_ID:d.queId,LOGIC_TYPE:d.logicType,SORT_LINE:d.sortLine,SORT_WORD:d.sortWord,SORT_OPTION_ITEM:d.sortItem},s={SORT_LINE:_.sortLine,SORT_WORD:_.sortWord,SORT_PLACE_HOLDER:_.sortPlaceHolder,DISABLE:_.disable,HIDDEN:_.hidden},c=function(t,e,n,a){this._queId=t,this._rootId=e,this._element=n,this._sortData=a||[],this._rows=0,this._logicTypeId=""};c.prototype.fillDataIntoComponent=function(t){var e=this,n=c._getSortLineList(this._element);[].forEach.call(n,function(t){t.innerHTML=""});var a=t.length;if(a>0){for(var i=0,o=void 0,r=void 0;i<a;i++)if(o=t[i]){var u=JSON.stringify(o),d="["+l.SORT_OPTION_ITEM+"="+u+"]";if(!(r=e._element.querySelector(d)))continue;var p=e._getItem({content:o});n[e._rows].appendChild(p),e._layoutItem(),r.classList.add(s.HIDDEN)}this._initEventForEle()}},c.prototype._getItem=function(t){var e=document.createElement("li");return e.classList.add(s.SORT_WORD),e.setAttribute(l.SORT_WORD,t.content),e.innerText=t.content,e},c.prototype._layoutItem=function(){var t,e=this,n=this._element.querySelectorAll(r.SORT_WORD),a=c._getSortLineList(this._element),i=this._element.querySelector(r.SORT_LINE_CONT),o=i.offsetWidth,u=[],d=0,p=0,_={};[].forEach.call(n,function(e,n){t=e.offsetWidth+20,d+=t,d>=o&&(p+=1,d=t),_[p]||(_[p]=[]),_[p].push(n),u.push(e.getAttribute(l.SORT_WORD))});for(var I in _)!function(t){var o=a[t];o||(o=document.createElement("ul"),o.setAttribute(l.SORT_LINE,""),o.classList.add(s.SORT_LINE),i.appendChild(o),e._initEventForEle()),o.innerHTML="";var r=_[t];r.length&&r.forEach(function(t){o.appendChild(n[t])})}(I);this._rows=p,this._sortData=u},c.prototype._notify=function(){this._logicType||(this._logicType=parseInt(this._element.getAttribute(l.LOGIC_TYPE),10));var t={queId:this._queId,rootId:this._rootId,data:this._sortData,type:this._logicType};a.set(this._queId,t),o(t)},c.prototype._initEventForEle=function(t){var e=this,n=t||c._getSortLineList(this._element),a="sort-"+this._queId,i=[10,window.innerWidth-10,10,window.innerHeight-10];[].forEach.call(n,function(t){t.talqsSortableInstance||(t.talqsSortableInstance=Sortable.create(t,{group:a,top:40,bounds:i,onSort:function(){e._layoutItem(),e._notify()}}))})},c.prototype.updateSortIndex=function(t){var e=c._getSortLineList(this._element);e[this._rows].appendChild(this._getItem(t)),0===this._sortData.length&&this._initEventForEle(e),this._sortData.push(t.content),this._layoutItem(),this._notify()},c._getInstance=function(e,n,a){var i=t(a).data("talqs.dragSort");return i||(i=new c(e,n,a,[]),t(a).data("talqs.dragSort",i)),i},c._getRootId=function(e){var n=t(e).closest(r.ROOT_QS_CONTAINER)[0];return n&&n.getAttribute(l.ROOT_QS_ID)},c._getQueId=function(t){return t&&t.getAttribute(l.QUE_ID)},c._getOptionContent=function(t){return t.querySelector(r.SORT_OPTION_CONTENT).innerText},c._getSortLineList=function(t){return t.querySelectorAll(r.SORT_LINE)},c._dataApiClickHandler=function(){if(F.isInteractive){if(!([].slice.call(this.classList).indexOf(s.DISABLE)>=0)){var e=t(this).closest(r.DRAG_SORT_TYPE)[0],n=c._getQueId(e),a=c._getRootId(this);if(n&&a){var i={content:this.textContent};this.classList.add(s.HIDDEN),c._getInstance(n,a,e).updateSortIndex(i)}}}},c._dataInitialHandler=function(){for(var t=document.querySelectorAll(r.DRAG_SORT_TYPE),e=t.length||0,n=0;n<e;n++){var i=t[n],o=c._getQueId(i),l=c._getRootId(i),s=o&&a.cache[o];l&&s&&s.data&&c._getInstance(o,l,i).fillDataIntoComponent(s.data)}},c._toggleInteractionHandler=function(t){(t.data||[]).forEach(function(t){var e=document.querySelector(r.DRAG_SORT_TYPE+"["+l.QUE_ID+'="'+t.queId+'"]');if(e){var n=1===t.rectifyState[0],a=c._getSortLineList(e);[].forEach.call(a,function(t){t.talqsSortableInstance&&t.talqsSortableInstance.option("disabled",n)});var i=e.querySelector(r.SORT_OPTION_LIST);[].forEach.call(i.children,function(t){t.classList.toggle(s.DISABLE,n)})}})},t(document).on(e.CLICK_DATA_API,r.SORT_OPTION_ITEM,c._dataApiClickHandler),t(document).on(i.CHANGE,c._dataInitialHandler),document.addEventListener(i.TOGGLE_INTEACTION,c._toggleInteractionHandler)}(jQuery),function(t){var e={APP_CONTAINER:"["+d.app+"]",ROOT_QS_CONTAINER:"["+d.rootId+"]",DRAG_MATCH_TYPE:"["+d.type+'="dragMatch"]',MATCH_CONTAINER:"["+d.matchContainer+"]",MATCH_ITEM:"["+d.matchItem+"]",OPTION_CONTAINER:"."+_.optionWrapper,OPTION_LIST:"."+_.options},n={ROOT_QS_ID:d.rootId,QUE_ID:d.queId,LOGIC_TYPE:d.logicType,OPTION_GROUP:d.optionGroup,OPTION_ITEM:d.optionItem},r={DROP_ACTIVE:_.dropActive,DROP_HOVER:_.dropHover,ACTIVE:_.active,WRONG:_.wrong,RIGHT:_.right},l=function(t,e,n,a){this._queId=t,this._rootId=e,this._element=n,this._blankData=a||[],this._matchContainerList=null,this._matchItemList=null};l.prototype.getMatchContainerList=function(){return this._matchContainerList||(this._matchContainerList=this._element.querySelectorAll(e.MATCH_CONTAINER)),this._matchContainerList},l.prototype.getMatchItemList=function(){return this._matchItemList||(this._matchItemList=this._element.querySelectorAll(e.MATCH_ITEM)),this._matchItemList},l.prototype.updateBlankValueByIndex=function(t,e){var i=this;if(t=parseInt(t,10),!isNaN(t)){var r=this.getMatchContainerList(),l=this._blankData.indexOf(e),s=parseInt(t,10);if(l===s)return;l>=0&&(this._blankData[l]="",r[l].innerText=""),this._blankData[s]=e,r[s].innerText=e;for(var c=r.length||0,u=[],d=0;d<c;d++)u.push(i._blankData[d]||"");this._logicType||(this._logicType=parseInt(this._element.getAttribute(n.LOGIC_TYPE),10));var p={queId:this._queId,rootId:this._rootId,data:u,type:this._logicType};a.set(this._queId,p),o(p)}},l.prototype.initHandler=function(){var a=this,i=function(t,e){a.updateBlankValueByIndex(t,e)},o=this._element.querySelectorAll(e.MATCH_ITEM),l=this._element.querySelector(e.OPTION_LIST),s=this._element.querySelector(e.OPTION_CONTAINER),c=document.body.offsetWidth-10,u=document.body.offsetHeight-10;t(o).draggable({addClasses:!1,containment:l,appendTo:s,helper:"clone",revert:"invalid",revertDuration:200,scroll:!0,drag:function(t,e){(t.clientX<10||t.clientY<10||t.clientX>c||t.clientY>u)&&t.preventDefault()}});var d=function(t,e){if(F.isInteractive){var a=e.draggable[0];if(a){var o=a.parentNode.getAttribute(n.OPTION_ITEM),r=this.parentNode.parentNode.getAttribute(n.OPTION_GROUP);i(r,o)}}},p=this._element.querySelectorAll(e.MATCH_CONTAINER);t(p).droppable({tolerance:"touch",accept:e.MATCH_ITEM,drop:d,activeClass:r.DROP_ACTIVE,hoverClass:r.DROP_HOVER})},l.prototype.fillDataIntoComponent=function(t){var e=t.data||[],n=t.result||[];this._blankData=e;var a=this.getMatchContainerList();[].forEach.call(a,function(t,a){t.innerText=e[a]||"",t.classList.toggle(r.WRONG,0===n[a]),t.classList.toggle(r.RIGHT,1===n[a])})},l._getInstance=function(e,n,a){var i=t(a).data("talqs.dragMatch");return i||(i=new l(e,n,a,[]),t(a).data("talqs.dragMatch",i)),i},l._instanceInitHandler=function(){var t=document.querySelectorAll(e.DRAG_MATCH_TYPE);[].forEach.call(t,function(t){var e=t.getAttribute(n.QUE_ID),a=l._getRootId(t);e&&a&&l._getInstance(e,a,t).initHandler()})},l._getRootId=function(a){var i=t(a).closest(e.ROOT_QS_CONTAINER)[0];return i&&i.getAttribute(n.ROOT_QS_ID)},l._dataInitialHandler=function(){for(var t=document.querySelectorAll(e.DRAG_MATCH_TYPE),i=t&&t.length||0,o=0;o<i;o++){var r=t[o],s=r.getAttribute(n.QUE_ID),c=l._getRootId(r),u=s&&a.cache[s];c&&u&&l._getInstance(s,c,r).fillDataIntoComponent(u)}},l._toggleInteractionHandler=function(a){(a.data||[]).forEach(function(a){var i=document.querySelector(e.DRAG_MATCH_TYPE+"["+n.QUE_ID+'="'+a.queId+'"]');if(i){var o=i.querySelectorAll(e.MATCH_CONTAINER);[].forEach.call(o,function(e,n){t(e).droppable(1===a.rectifyState[n]?"disable":"enable")})}})};var s=document.querySelector(e.APP_CONTAINER),c=window.MutationObserver||window.WebKitMutationObserver,u=new c(l._instanceInitHandler);s&&u.observe(s,{childList:!0,attributes:!0}),t(document).on(i.CHANGE,l._dataInitialHandler),document.addEventListener(i.TOGGLE_INTEACTION,l._toggleInteractionHandler)}(jQuery),"data.logicQuesTypeId"),H=D+" == 6",w="'<button class=\""+_.optionsContent+'" '+d.sortItem+'="$[value]">$[value]</button>\'',x=' <ul class="'+_.sortLine+'" '+d.sortLine+"></ul> ",G='\n  <div>{{data.queDesc}}</div>\n  <div class="'+_.sortLineContainer+'" '+d.sortLineContainer+">\n    "+function(t){t=parseInt(t,10)||0;for(var e="",n=0;n<t;n++)e+=x;return e}(2)+"\n  </div>\n  <div "+d.optionList+'>\n    {{#data.content | transContentToList:"   " | renderList:'+w+"}}\n  </div>\n",k="\n  {{if data.content && !data.hideContent}}\n    {{ if data.logicQuesTypeId == 13 }}\n      "+G+'\n    {{ else }}\n      <div class="'+_.content+" "+_.clear+'" id="content{{data.queId}}">\n       {{#data.content | transfromBlankContent:data}}\n      </div>\n    {{/if}}\n  {{/if}}\n',M=d.optionGroup+"{{data.queId}}{{$index}}",$=function(t,e){return"{{#$value"+(void 0==e?"":"["+e+"]")+"['"+t+"'] | wrapperImage}}"},Q=function(t){return"<button "+d.optionItem+'="'+t+'">'+t+"</button>"},z=function(t){var e=$("aoVal",t),n=$("content",t);return'\n      <li class="'+_.optionsItem+" "+_.clear+'"\n          {{if !(data.logicQuesTypeId == 5) }}\n              '+d.optionItem+'="'+e+'"\n          {{/if}}>\n\n          <span class="'+_.optionsLabel+'" '+(t>0?d.matchItem:"")+">"+e+'</span>\n          <div class="'+_.optionsContent+'" '+d.optionContent+">"+n+'</div>\n        {{if data.logicQuesTypeId == 5 }}\n          \x3c!--判断题--\x3e\n          <div class="'+_.tfText+'">\n            '+Q("T")+"\n            "+Q("F")+"\n          </div>\n        {{/if}}\n\n        {{if "+t+' === 0 }}\n          \x3c!--排序题第一列--\x3e\n          <div class="'+_.optionMatch+'" '+d.matchContainer+"></div>\n        {{/if}}\n      </li>\n    "},B=function(t){return'\n    <ul class="'+_.optionsList+'" \n        '+d.autoLayout+'="{{ data.logicQuesTypeId == 7 ? 0 : data.answerOptionList[0].length}}"\n        '+d.optionList+'>\n      {{each data.answerOptionList }}\n        <li class="'+_.optionsRows+" "+_.clear+'" \n            {{ if data.isCloze }}\n              id="'+M+'">\n              \x3c!--子题题号--\x3e\n              <span class="'+_.optionsIndex+'">{{$index+1}}. </span>\n            {{else}}\n              >\n            {{/if}}\n\n          <ul class="'+_.optionsColumns+"_{{$value.length}} "+_.clear+'" \n              '+d.optionGroup+'="{{$index}}"\n              '+d.autoLayout+'="{{ data.isCloze ? 1 : 0 }}" \n              '+d.optionAnalyze+'="{{data.isCloze || data.logicQuesTypeId == 5 ? 1 : 0}}">\n\n            {{if '+H+" }}\n                "+z(t||0)+"\n            {{else}}\n              {{each $value}}\n                "+z()+"\n              {{/each}}\n            {{/if}}\n\n          </ul>\n        </li>\n      {{/each}}\n    </ul>\n    "},W='\n{{ if data.answerOptionList  }}\n    <div class="'+_.optionWrapper+'">\n        <div class="'+_.options+" "+_.clear+'">\n         '+B()+"\n         {{if "+H+" }}\n          "+B(1)+'\n         {{/if}}\n         {{if data.logicQuesTypeId == 6 || data.logicQuesTypeId == 3 }}\n           <div class="'+_.analyzeContainer+'"></div>\n         {{/if}}\n        </div>\n    </div>\n{{/if}}',U='\n  {{if data.logicQuesTypeId == 8 || data.isPhoto }}\n    <div class="'+_.panel+" "+_.imgsContainer+'">\n    </div>\n  {{/if}}\n',K='\n<div  class="'+_.stems+" "+_.clear+' {{getStyle(data)}}"  \n      data-talqs-type="{{getInteractiveType(data)}}" \n      data-que-id="{{data.queId}}" \n      data-logic-type="{{'+D+"}}\">\n   {{each config.templates['stemsWrapper']}}\n      {{include $value}}\n   {{/each}}\n</div>\n",Y={questionContent:k,questionOptions:W,questionImgAnswer:U,questionLineCont:G,question:K};!function(t){for(var e in C)t.registerHelper(e,C[e]);var n=t.components;t.updateTemplateList((a={},a[n.StemsWrapper]={template:Y.question,components:[{name:n.Content,template:Y.questionContent},{name:n.Options,template:Y.questionOptions},{name:"questionImgAnswer",template:Y.questionImgAnswer}]},a[n.AnalyzeWrapper]={exclude:[n.QueID,n.KnowledgePoint]},a));var a}(TalqsTemplate);var F={setData:function(t){if(Array.isArray(t))t.forEach(function(t){a.set(t.queId,t)});else for(var e in t)a.set(e,t[e]);document.dispatchEvent(new Event(i.CHANGE))},getData:function(t){return a.get(t)},isInteractive:!0,isUndefined:function(t){return void 0===t},toggleValue:function(t,e){return this.isUndefined(t)?!e:Boolean(t)},toggleInteraction:function(t){var e=new Event(i.TOGGLE_INTEACTION);e.data=t,document.dispatchEvent(e)},onChange:null};return F});