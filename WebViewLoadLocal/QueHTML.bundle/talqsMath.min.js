!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=wt.call(arguments,0,e),i=wt.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=yt(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=wt.call(arguments,1);return function(){return t.apply(this,e)}}function s(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){s("a direction was passed",t===qt||t===_t)}function o(t,e,n){s("a parent is always present",t),s("leftward is properly set up",function(){return e?e[_t]===n&&e.parent===t:t.ends[qt]===n}()),s("rightward is properly set up",function(){return n?n[qt]===e&&n.parent===t:t.ends[_t]===e}())}function a(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function l(t){return a(),ft(t)}function c(e){function n(t){var e,n;return t&&t.nodeType?(e=Et(t).children(".mq-root-block").attr(vt),n=e&&Ct.byId[e].controller,n?s[n.KIND_OF_MQ](n):null):null}function i(t,e){var n,i,r;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s});for(n in e)e.hasOwnProperty(n)&&(i=e[n],r=jt[n],t[n]=r?r(i):i)}var s,r,o;if(!(e>=v&&g>=e))throw"Only interface versions between "+v+" and "+g+" supported. You specified: "+e;s={},n.L=qt,n.R=_t,n.config=function(t){return i(Lt.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";It[t]=e},r=s.AbstractMathQuill=xt(Dt,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=Et('<span class="mq-root-block"/>').attr(vt,i.id).appendTo(s),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),n.prototype=r.prototype,s.EditableField=xt(r,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)?(t=t.slice(1),(e=St[t])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[qt];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(qt)},e.moveToRightEnd=function(){return this.moveToDirEnd(_t)},e.keystroke=function(e){var n;for(e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i,s=t-Et(window).scrollLeft(),r=e-Et(window).scrollTop(),o=document.elementFromPoint(s,r);this.__controller.seek(Et(o),t,e),i=ut().setOptions(n),i.createLeftOf(this.__controller.cursor)},e.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return pt.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek(Et(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=s.EditableField.prototype;for(o in Mt)!function(t,i){var r=s[t]=i(s);n[t]=function(i,s){var o,a=n(i);return a instanceof r||!i||!i.nodeType?a:(o=At(r.RootBlock(),Et(i),Lt()),o.KIND_OF_MQ=t,r(o).__mathquillify(s,e))},n[t].prototype=r.prototype}(o,Mt[o]);return n}function h(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function u(t,e,n){return xt(T,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function f(t){var e=this.parent,n=t;do{if(n[_t])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function d(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));X(this.delimjQs,gt(1+.2*(t-1),1.2),1.2*t)}}function p(t,e){var e=e||t,n=ct[t],s=ct[e];Tt[t]=i(lt,qt,t,n,e,s),Tt[n]=i(lt,_t,t,n,e,s)}var m,v,g,b,w,y,x,q,_,E,k,C,O,S,T,z,Q,A,M,L,j,D,I,R,F,N,H,P,B,V,U,$,K,X,G,W,Y,Z,J,tt,et,nt,it,st,rt,ot,at,lt,ct,ht,ut,ft,dt,pt=window.jQuery,mt="mathquill-command-id",vt="mathquill-block-id",gt=Math.min,bt=Math.max,wt=[].slice,yt=e(function(t,n){return e(function(e,i){return t in e?e[t].apply(e,n.concat(i)):void 0})}),xt=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function n(o,a){function l(){var t=new c;return s(t.init)&&t.init.apply(t,arguments),t}function c(){}var h,u,f;return void 0===a&&(a=o,o=Object),l.Bare=c,h=r[t]=o[t],u=c[t]=l[t]=l.p=new r,u.constructor=l,l.extend=function(t){return n(l,t)},(l.open=function(t){if(f={},s(t)?f=t.call(l,u,h,l,o):i(t)&&(f=t),i(f))for(var n in f)e.call(f,n)&&(u[n]=f[n]);return s(u.init)||(u.init=o),l})(a)}}("prototype",{}.hasOwnProperty),qt=-1,_t=1,Et=xt(pt,function(t){t.insDirOf=function(t,e){return t===qt?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===qt?this.prependTo(e):this.appendTo(e)}}),kt=xt(function(t){t.parent=0,t[qt]=0,t[_t]=0,t.init=function(t,e,n){this.parent=t,this[qt]=e,this[_t]=n},this.copy=function(t){return kt(t.parent,t[qt],t[_t])}}),Ct=xt(function(t){function e(){return i+=1}t[qt]=0,t[_t]=0,t.parent=0;var i=0;this.byId={},t.init=function(){this.id=e(),Ct.byId[this.id]=this,this.ends={},this.ends[qt]=0,this.ends[_t]=0},t.dispose=function(){delete Ct.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=Et(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id"),n&&Ct.byId[n].jQadd(t),i&&Ct.byId[i].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=Et(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[qt],e[_t]),n},t.createLeftOf=function(t){return this.createDir(qt,t)},t.selectChildren=function(t,e){return Qt(t,e)},t.bubble=n(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[qt]&&0===this.ends[_t]},t.children=function(){return Ot(this.ends[qt],this.ends[_t])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return Ot(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return Ot(this,this).adopt(t,e,n),this},t.disown=function(){return Ot(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),Ot=xt(function(t){t.init=function(t,e,n){if(n===m&&(n=qt),r(n),s("no half-empty fragments",!t==!e),this.ends={},t){s("withDir is passed to Fragment",t instanceof Ct),s("oppDir is passed to Fragment",e instanceof Ct),s("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=Et(),t.withDirAdopt=function(t,e,n,i){return t===qt?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,r;return o(t,e,n),i=this,i.disowned=!1,(s=i.ends[qt])?(r=i.ends[_t],e||(t.ends[qt]=s),n?n[qt]=r:t.ends[_t]=r,i.ends[_t][_t]=n,i.each(function(n){n[qt]=e,n.parent=t,e&&(e[_t]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[qt];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[_t],e=i.parent,o(e,i[qt],i),o(e,t,t[_t]),i[qt]?i[qt][_t]=t[_t]:e.ends[qt]=t[_t],t[_t]?t[_t][qt]=i[qt]:e.ends[_t]=i[qt],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e=this,n=e.ends[qt];if(!n)return e;for(;n!==e.ends[_t][_t]&&!1!==t(n);n=n[_t]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),St={},Tt={},zt=xt(kt,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=Et('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[_t]?this.selection&&this.selection.ends[qt][qt]===this[qt]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[_t].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=Et(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return r(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(qt,t)},t.insRightOf=function(t){return this.insDirOf(_t,t)},t.insAtDirEnd=function(t,e){return r(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(qt,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(_t,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=kt.copy(s),n=s.upDownCache[e.id],n?n[_t]?s.insLeftOf(n[_t]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s))},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[_t],i=this,s=t[qt];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[_t])}),!this[_t])if(this[qt])this[_t]=this[qt][_t];else for(;!this[_t];){if(this.parent=this.parent[_t],!this.parent){this[_t]=t[_t],this.parent=e;break}this[_t]=this.parent.ends[qt]}this[_t]?this.insLeftOf(this[_t]):this.insAtRightEnd(e),t.jQ.remove(),t[qt].siblingDeleted&&t[qt].siblingDeleted(i.options,_t),t[_t].siblingDeleted&&t[_t].siblingDeleted(i.options,qt)},t.startSelection=function(){var t,e=this.anticursor=kt.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,r,o,a,l=this.anticursor;if(this[qt]===l[qt]&&this.parent===l.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in l.ancestors){e=t.parent;break}if(s("cursor and anticursor in the same tree",e),n=l.ancestors[e.id],o=_t,t[qt]!==n)for(a=t;a;a=a[_t])if(a[_t]===n[_t]){o=qt,i=t,r=n;break}return o===_t&&(i=n,r=t),i instanceof kt&&(i=i[_t]),r instanceof kt&&(r=r[qt]),this.hide().selection=e.selectChildren(i,r),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[qt]=this.selection.ends[qt][qt],this[_t]=this.selection.ends[_t][_t],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[qt]=t.ends[qt][qt],this[_t]=t.ends[_t][_t],delete this.selection),t}}),Qt=xt(Ot,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),At=xt(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=zt(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===qt||e===_t?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),Mt={},Lt=xt(),jt={},Dt=xt(),It={};l.prototype=Dt.p,l.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return a=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},a(),l},l.getInterface=c,v=c.MIN=1,g=c.MAX=2,l.noConflict=function(){return window.MathQuill=b,l},b=window.MathQuill,window.MathQuill=l,w=xt(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var r,o,a;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(a)._(""+t,e,i)},t.or=function(t){s("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function r(e){return t._(n,i,s)}return e._(n,i,r)})},t.then=function(t){var e=this;return n(function(i,r,o){function a(e,i){var a=t instanceof n?t:t(i);return s("a parser is returned",a instanceof n),a._(e,r,o)}return e._(i,a,o)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,o.push(n),!0}function r(){return!1}for(var o=[];t._(e,s,r););return n(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function o(t,e){return u.push(e),n=t,!0}function a(t,e){return c=e,n=t,!1}function l(t,e){return!1}var c,h,u=[],f=!0;for(h=0;t>h;h+=1)if(!(f=i._(n,o,a)))return r(n,c);for(;e>h&&f;h+=1)f=i._(n,o,l);return s(n,u)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})},r=this.regex=function(t){s("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r,o=t.exec(n);return o?(r=o[0],i(n.slice(r.length),r)):s(n,e)})},o=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),a=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),y=function(){function e(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){y=t,clearTimeout(p),p=setTimeout(t)}function r(e){y(),y=t,clearTimeout(p),b.val(e),e&&b[0].select&&b[0].select(),m=!!e}function o(){var t=b[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function a(){i.keystroke(e(v),v)}function l(e){v=e,g=null,m&&s(function(e){e&&"focusout"===e.type||!b[0].select||b[0].select(),y=t,clearTimeout(p)}),a()}function c(t){v&&g&&a(),g=t,s(h)}function h(){if(!o()){var t=b.val();1===t.length?(b.val(""),i.typedText(t)):t&&b[0].select&&b[0].select()}}function u(){v=g=null}function f(t){b.focus(),s(d)}function d(){var t=b.val();b.val(""),t&&i.paste(t)}var p,m,v=null,g=null,b=pt(n),w=pt(i.container||b),y=t;return w.bind("keydown keypress input keyup focusout paste",function(t){y(t)}),m=!1,w.bind({keydown:l,keypress:c,focusout:u,paste:f}),{select:r}}}(),At.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),At.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),Et(window).off("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),Et(window).on("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),At.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),Ct.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(qt);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(_t,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(qt,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[_t];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[_t]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[qt];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[qt]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[qt])for(;i[qt];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[_t])for(;i[_t];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(_t);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[qt];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){s("overridden or never called on this node")}}),At.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[_t][i]?n.insAtLeftEnd(n[_t][i]):n[qt][i]?n.insAtRightEnd(n[qt][i]):n.parent.bubble(function(t){var e=t[s];return(!e||("function"==typeof e&&(e=t[s](n)),e instanceof Ct&&n.jumpUpDown(t,e),!0===e))&&void 0}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var i=this.cursor;return i.parent!==this.root&&n.preventDefault(),i.parent!==this.root?(i.parent.moveOutOf(t,i),this.notify("move")):void 0},jt.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(qt)},t.moveRight=function(){return this.moveDir(_t)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return r(t),e=this.cursor,n=e.selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[qt].siblingDeleted&&e[qt].siblingDeleted(e.options,_t),e[_t].siblingDeleted&&e[_t].siblingDeleted(e.options,qt),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){r(t);var e=this.cursor;return!e[qt]||e.selection?ctrlr.deleteDir():(this.notify("edit"),Ot(e.parent.ends[qt],e[qt]).remove(),e.insAtDirEnd(qt,e.parent),e[qt].siblingDeleted&&e[qt].siblingDeleted(e.options,_t),e[_t].siblingDeleted&&e[_t].siblingDeleted(e.options,qt),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(qt)},t.deleteForward=function(){return this.deleteDir(_t)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;r(t),n.anticursor||n.startSelection(),e=n[t],e?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(qt)},t.selectRight=function(){return this.selectDir(_t)}}),x=function(){function t(t){var e=O();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||O();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[_t],0);return n}var n=w.string,i=w.regex,s=w.letter,r=w.any,o=w.optWhitespace,a=w.succeed,l=w.fail,c=s.map(function(t){return j(t)}),h=i(/^[^${}\\_^]/).map(function(t){return k(t)}),u=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(r))).then(function(t){var e=St[t];return e?e(t).parser():l("unknown command: \\"+t)}),f=u.or(c).or(h),d=n("{").then(function(){return m}).skip(n("}")),p=o.then(d.or(f.map(t))),m=p.many().map(e).skip(o),v=n("[").then(p.then(function(t){return"]"!==t.join("latex")?a(t):l()}).many().map(e).skip(o)).skip(n("]")),g=m;return g.block=p,g.optBlock=v,g}(),At.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e,n=this.notify("edit").cursor,i=w.all,s=w.eof,r=x.skip(s).or(i.result(!1)).parse(t);return r&&!r.isEmpty()&&(r.children().adopt(n.parent,n[qt],n[_t]),e=r.jQize(),e.insertBefore(n.jQ),n[qt]=r.ends[_t],r.finalizeInsert(n.options,n),r.ends[_t][_t].siblingCreated&&r.ends[_t][_t].siblingCreated(n.options,qt),r.ends[qt][qt].siblingCreated&&r.ends[qt][qt].siblingCreated(n.options,_t),n.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n,i=this.root,s=this.cursor,r=w.all,o=w.eof,a=x.skip(o).or(r.result(!1)).parse(t);i.eachChild("postOrder","dispose"),i.ends[qt]=i.ends[_t]=0,a&&a.children().adopt(i,0,0),e=i.jQ,a?(n=a.join("html"),e.html(n),i.jQize(e.children()),i.finalizeInsert(s.options)):e.empty(),delete s.selection,s.insAtRightEnd(i)},t.renderLatexText=function(t){var e,n,i,s,r,o,a,l,c,h,u=this.root,f=this.cursor;if(u.jQ.children().slice(1).remove(),u.eachChild("postOrder","dispose"),u.ends[qt]=u.ends[_t]=0,delete f.selection,f.show().insAtRightEnd(u),e=w.regex,n=w.string,i=w.eof,s=w.all,r=n("$").then(x).skip(n("$").or(i)).map(function(t){var e,n=Q(f);return n.createBlocks(),e=n.ends[qt],t.children().adopt(e,0,0),n}),o=n("\\$").result("$"),a=o.or(e(/^[^$]/)).map(k),l=r.or(a).many(),c=l.skip(i).or(s.result(!1)).parse(t)){for(h=0;h<c.length;h+=1)c[h].adopt(u,u.ends[_t],0);u.jQize().appendTo(u.jQ),u.finalizeInsert(f.options)}}}),At.open(function(e){Lt.p.ignoreNextMousedown=t,e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){o=Et(t.target)}function s(t){h.anticursor||h.startSelection(),c.seek(o,t.pageX,t.pageY).cursor.select(),o=m}function r(t){h.blink=u,h.selection||(c.editable?h.show():f.detach()),a.unbind("mousemove",i),Et(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",r)}var o,a=Et(n.target).closest(".mq-root-block"),l=Ct.byId[a.attr(vt)||e.attr(vt)],c=l.controller,h=c.cursor,u=h.blink,f=c.textareaSpan,d=c.textarea;n.preventDefault(),n.target.unselectable=!0,h.options.ignoreNextMousedown(n)||(h.options.ignoreNextMousedown=t,c.blurred&&(c.editable||a.prepend(f),d.focus()),h.blink=t,c.seek(Et(n.target),n.pageX,n.pageY).cursor.startSelection(),a.mousemove(i),Et(n.target.ownerDocument).mousemove(s).mouseup(r))})}}),At.open(function(t){t.seek=function(t,e,n){var i,r,o,a=this.notify("select").cursor;return t&&((i=t.attr(vt)||t.attr(mt))||(r=t.parent(),i=r.attr(vt)||r.attr(mt))),o=i?Ct.byId[i]:this.root,s("nodeId is the id of some Node that exists",o),a.clearSelection().show(),o.seek(e,a),this.scrollHoriz(),this}}),At.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,o=r.selection,a=this.root.jQ[0].getBoundingClientRect();if(o)if(n=o.jQ[0].getBoundingClientRect(),i=n.left-(a.left+20),s=n.right-(a.right-20),o.ends[qt]===r[_t])if(0>i)e=i;else{if(!(s>0))return;e=n.left-s<a.left+20?i:s}else if(s>0)e=s;else{if(!(0>i))return;e=n.right-i>a.right-20?s:i}else if((t=r.jQ[0].getBoundingClientRect().left)>a.right-20)e=t-(a.right-20);else{if(!(t<a.left+20))return;e=t-(a.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),At.open(function(t){Lt.p.substituteTextarea=function(){return Et("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=Et('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=Et(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()},t.container.bind("copy",function(){t.setTextareaSelection()})},t.selectionChanged=function(){var t=this;G(t.container[0]),t.textareaSelectionTimeout===m&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=m;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},t.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,s=y(n,this);this.selectFn=function(t){s.select(t)},this.container.prepend(i).on("cut",function(n){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),q=xt(Ct,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[_t].siblingCreated&&n[_t].siblingCreated(t,qt),n[qt].siblingCreated&&n[qt].siblingCreated(t,_t),n.bubble("reflow")}}),_=xt(q,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=x.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[_t],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[qt],0,0),i.jQ.appendTo(n.ends[qt].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),s=n.blocks=Array(i);for(t=0;i>t;t+=1)e=s[t]=O(),e.adopt(n,n.ends[_t],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[qt],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return Qt(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[qt]=t.jQ.offset().left,e[_t]=e[qt]+t.jQ.outerWidth(),e}var i,s=this,r=n(s);return t<r[qt]?e.insLeftOf(s):t>r[_t]?e.insRightOf(s):(i=r[qt],void s.eachChild(function(o){var a=n(o);return t<a[qt]?(t-i<a[qt]-t?o[qt]?e.insAtRightEnd(o[qt]):e.insLeftOf(s):e.insAtLeftEnd(o),!1):t>a[_t]?void(o[_t]?i=a[_t]:r[_t]-t<t-a[_t]?e.insRightOf(s):e.insAtRightEnd(o)):(o.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){
var t,e,n,i=this,r=i.blocks,o=" mathquill-command-id="+i.id,a=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(s("no unmatched angle brackets",a.join("")===this.htmlTemplate),t=0,e=a[0];e;t+=1,e=a[t])if("/>"===e.slice(-2))a[t]=e.slice(0,-2)+o+"/>";else if("<"===e.charAt(0)){s("not an unmatched top-level close tag","/"!==e.charAt(1)),a[t]=e.slice(0,-1)+o+">",n=1;do{t+=1,e=a[t],s("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return a.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+r[e].id+">"+r[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),E=xt(_,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return w.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),k=xt(E,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),C=xt(E,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),O=xt(q,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[qt]===this.ends[_t]&&0!==this.ends[qt]?this.ends[qt].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?qt:_t,t,n))},t.moveOutOf=function(t,e,n){n&&this.parent[n+"Into"]||!this[t]?e.insDirOf(t,this.parent):e.insAtDirEnd(-t,this[t])},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[_t];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[qt].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[qt];return n.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?j(t):/^\d$/.test(t)?M(t):(e=Tt[t]||St[t])?e(t):k(t)},t.write=function(t,e){var n=this.chToCmd(e);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),Mt.StaticMath=function(t){return xt(t.AbstractMathQuill,function(e,n){this.RootBlock=O,e.__mathquillify=function(){return n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})},S=xt(O,h),Mt.MathField=function(e){return xt(e.EditableField,function(e,n){this.RootBlock=S,e.__mathquillify=function(e,i){return this.config(e),i>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},T=xt(Ct,function(t,e){function n(t){var e,n;return t.jQ[0].normalize(),(e=t.jQ[0].firstChild)?(s("only node in TextBlock span is Text node",3===e.nodeType),n=z(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)):void 0}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof Ot?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[qt]&&this.ends[qt].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,i=this;if(e.createLeftOf.call(this,t),i[_t].siblingCreated&&i[_t].siblingCreated(t.options,qt),i[qt].siblingCreated&&i[qt].siblingCreated(t.options,_t),i.bubble("reflow"),t.insAtRightEnd(i),i.replacedText)for(n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n))},t.parser=function(){var t=this,e=w.string,n=w.regex;return w.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?Ot():(z(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=_.prototype.selectTowards,t.deleteTowards=_.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var i,s;t.show().deleteSelection(),"$"!==n?t[qt]?t[qt].appendText(n):z(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),k("\\$","$").createLeftOf(t)):t[_t]?t[qt]?(i=T(),s=this.ends[qt],s.disown().jQ.detach(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e){var i,s,r,o,a,l,c,h;for(e.hide(),i=n(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s),0>=r?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r)),o=t-e.show().offset().left,a=o&&0>o?qt:_t,l=a;e[a]&&o*l>0;)e[a].moveTowards(a,e),l=o,o=t-e.offset().left;-a*l>a*o&&e[-a].moveTowards(-a,e),e.anticursor?e.anticursor.parent===this&&(c=e[qt]&&e[qt].text.length,this.anticursorPosition===c?e.anticursor=kt.copy(e):(this.anticursorPosition<c?(h=e[qt].splitRight(this.anticursorPosition),e[qt]=h):h=e[_t].splitRight(this.anticursorPosition-c),e.anticursor=kt(this,h[qt],h))):this.anticursorPosition=e[qt]&&e[qt].text.length},t.blur=function(t){O.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[qt]===this?t[qt]=this[qt]:t[_t]===this&&(t[_t]=this[_t])):n(this))},t.focus=O.prototype.focus}),z=xt(Ct,function(t,e){function n(t,e){return e.charAt(t===qt?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=Et(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===_t?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=z(this.text.slice(t)).adopt(this.parent,this,this[_t]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return r(t),i=n(-t,this.text),s=this[-t],s?s.insTextAtDirEnd(i,t):z(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===_t?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,o,a;return r(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(o=z(s).createDir(t,e),i[t]=o,e.insDirOf(t,o)):(a=this[-t],a?a.insTextAtDirEnd(s,t):(o=z(s).createDir(-t,e),o.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),Tt.$=St.text=St.textnormal=St.textrm=St.textup=St.textmd=T,St.em=St.italic=St.italics=St.emph=St.textit=St.textsl=u("\\textit","i",'class="mq-text-mode"'),St.strong=St.bold=St.textbf=u("\\textbf","b",'class="mq-text-mode"'),St.sf=St.textsf=u("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),St.tt=St.texttt=u("\\texttt","span",'class="mq-monospace mq-text-mode"'),St.textsc=u("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),St.uppercase=u("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),St.lowercase=u("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),Q=xt(_,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[qt].cursor=this.cursor,this.ends[qt].write=function(t,e){"$"!==e?O.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),k("\\$","$").createLeftOf(t.show())):t[_t]?t[qt]?O.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[qt].latex()+"$"}}),A=xt(S,function(t,e){t.keystroke=function(t){return"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):void 0},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)Q(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),k(e,n).createLeftOf(t)}}}),Mt.TextField=function(t){return xt(t.EditableField,function(t,e){this.RootBlock=A,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},St.notin=St.cong=St.equiv=St.oplus=St.otimes=xt(C,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),St["≠"]=St.ne=St.neq=i(C,"\\ne ","&ne;"),St.ast=St.star=St.loast=St.lowast=i(C,"\\ast ","&lowast;"),St.therefor=St.therefore=i(C,"\\therefore ","&there4;"),St.cuz=St.because=i(C,"\\because ","&#8757;"),St.prop=St.propto=i(C,"\\propto ","&prop;"),St["≈"]=St.asymp=St.approx=i(C,"\\approx ","&asymp;"),St.isin=St.in=i(C,"\\in ","&isin;"),St.ni=St.contains=i(C,"\\ni ","&ni;"),St.notni=St.niton=St.notcontains=St.doesnotcontain=i(C,"\\not\\ni ","&#8716;"),St.sub=St.subset=i(C,"\\subset ","&sub;"),St.sup=St.supset=St.superset=i(C,"\\supset ","&sup;"),St.nsub=St.notsub=St.nsubset=St.notsubset=i(C,"\\not\\subset ","&#8836;"),St.nsup=St.notsup=St.nsupset=St.notsupset=St.nsuperset=St.notsuperset=i(C,"\\not\\supset ","&#8837;"),St.sube=St.subeq=St.subsete=St.subseteq=i(C,"\\subseteq ","&sube;"),St.supe=St.supeq=St.supsete=St.supseteq=St.supersete=St.superseteq=i(C,"\\supseteq ","&supe;"),St.nsube=St.nsubeq=St.notsube=St.notsubeq=St.nsubsete=St.nsubseteq=St.notsubsete=St.notsubseteq=i(C,"\\not\\subseteq ","&#8840;"),St.nsupe=St.nsupeq=St.notsupe=St.notsupeq=St.nsupsete=St.nsupseteq=St.notsupsete=St.notsupseteq=St.nsupersete=St.nsuperseteq=St.notsupersete=St.notsuperseteq=i(C,"\\not\\supseteq ","&#8841;"),St.N=St.naturals=St.Naturals=i(k,"\\mathbb{N}","&#8469;"),St.P=St.primes=St.Primes=St.projective=St.Projective=St.probability=St.Probability=i(k,"\\mathbb{P}","&#8473;"),St.Z=St.integers=St.Integers=i(k,"\\mathbb{Z}","&#8484;"),St.Q=St.rationals=St.Rationals=i(k,"\\mathbb{Q}","&#8474;"),St.R=St.reals=St.Reals=i(k,"\\mathbb{R}","&#8477;"),St.C=St.complex=St.Complex=St.complexes=St.Complexes=St.complexplane=St.Complexplane=St.ComplexPlane=i(k,"\\mathbb{C}","&#8450;"),St.H=St.Hamiltonian=St.quaternions=St.Quaternions=i(k,"\\mathbb{H}","&#8461;"),St.quad=St.emsp=i(k,"\\quad ","    "),St.qquad=i(k,"\\qquad ","        "),St.diamond=i(k,"\\diamond ","&#9671;"),St.bigtriangleup=i(k,"\\bigtriangleup ","&#9651;"),St.ominus=i(k,"\\ominus ","&#8854;"),St.uplus=i(k,"\\uplus ","&#8846;"),St.bigtriangledown=i(k,"\\bigtriangledown ","&#9661;"),St.sqcap=i(k,"\\sqcap ","&#8851;"),St.triangleleft=i(k,"\\triangleleft ","&#8882;"),St.sqcup=i(k,"\\sqcup ","&#8852;"),St.triangleright=i(k,"\\triangleright ","&#8883;"),St.odot=St.circledot=i(k,"\\odot ","&#8857;"),St.bigcirc=i(k,"\\bigcirc ","&#9711;"),St.dagger=i(k,"\\dagger ","&#0134;"),St.ddagger=i(k,"\\ddagger ","&#135;"),St.wr=i(k,"\\wr ","&#8768;"),St.amalg=i(k,"\\amalg ","&#8720;"),St.models=i(k,"\\models ","&#8872;"),St.prec=i(k,"\\prec ","&#8826;"),St.succ=i(k,"\\succ ","&#8827;"),St.preceq=i(k,"\\preceq ","&#8828;"),St.succeq=i(k,"\\succeq ","&#8829;"),St.simeq=i(k,"\\simeq ","&#8771;"),St.mid=i(k,"\\mid ","&#8739;"),St.ll=i(k,"\\ll ","&#8810;"),St.gg=i(k,"\\gg ","&#8811;"),St.parallel=i(k,"\\parallel ","&#8741;"),St.nparallel=i(k,"\\nparallel ","&#8742;"),St.bowtie=i(k,"\\bowtie ","&#8904;"),St.sqsubset=i(k,"\\sqsubset ","&#8847;"),St.sqsupset=i(k,"\\sqsupset ","&#8848;"),St.smile=i(k,"\\smile ","&#8995;"),St.sqsubseteq=i(k,"\\sqsubseteq ","&#8849;"),St.sqsupseteq=i(k,"\\sqsupseteq ","&#8850;"),St.doteq=i(k,"\\doteq ","&#8784;"),St.frown=i(k,"\\frown ","&#8994;"),St.vdash=i(k,"\\vdash ","&#8870;"),St.dashv=i(k,"\\dashv ","&#8867;"),St.nless=i(k,"\\nless ","&#8814;"),St.ngtr=i(k,"\\ngtr ","&#8815;"),St.longleftarrow=i(k,"\\longleftarrow ","&#8592;"),St.longrightarrow=i(k,"\\longrightarrow ","&#8594;"),St.Longleftarrow=i(k,"\\Longleftarrow ","&#8656;"),St.Longrightarrow=i(k,"\\Longrightarrow ","&#8658;"),St.longleftrightarrow=i(k,"\\longleftrightarrow ","&#8596;"),St.updownarrow=i(k,"\\updownarrow ","&#8597;"),St.Longleftrightarrow=i(k,"\\Longleftrightarrow ","&#8660;"),St.Updownarrow=i(k,"\\Updownarrow ","&#8661;"),St.mapsto=i(k,"\\mapsto ","&#8614;"),St.nearrow=i(k,"\\nearrow ","&#8599;"),St.hookleftarrow=i(k,"\\hookleftarrow ","&#8617;"),St.hookrightarrow=i(k,"\\hookrightarrow ","&#8618;"),St.searrow=i(k,"\\searrow ","&#8600;"),St.leftharpoonup=i(k,"\\leftharpoonup ","&#8636;"),St.rightharpoonup=i(k,"\\rightharpoonup ","&#8640;"),St.swarrow=i(k,"\\swarrow ","&#8601;"),St.leftharpoondown=i(k,"\\leftharpoondown ","&#8637;"),St.rightharpoondown=i(k,"\\rightharpoondown ","&#8641;"),St.nwarrow=i(k,"\\nwarrow ","&#8598;"),St.ldots=i(k,"\\ldots ","&#8230;"),St.cdots=i(k,"\\cdots ","&#8943;"),St.vdots=i(k,"\\vdots ","&#8942;"),St.ddots=i(k,"\\ddots ","&#8945;"),St.surd=i(k,"\\surd ","&#8730;"),St.triangle=i(k,"\\triangle ","&#9651;"),St.ell=i(k,"\\ell ","&#8467;"),St.top=i(k,"\\top ","&#8868;"),St.flat=i(k,"\\flat ","&#9837;"),St.natural=i(k,"\\natural ","&#9838;"),St.sharp=i(k,"\\sharp ","&#9839;"),St.wp=i(k,"\\wp ","&#8472;"),St.bot=i(k,"\\bot ","&#8869;"),St.clubsuit=i(k,"\\clubsuit ","&#9827;"),St.diamondsuit=i(k,"\\diamondsuit ","&#9826;"),St.heartsuit=i(k,"\\heartsuit ","&#9825;"),St.spadesuit=i(k,"\\spadesuit ","&#9824;"),St.parallelogram=i(k,"\\parallelogram ","&#9649;"),St.square=i(k,"\\square ","&#11036;"),St.oint=i(k,"\\oint ","&#8750;"),St.bigcap=i(k,"\\bigcap ","&#8745;"),St.bigcup=i(k,"\\bigcup ","&#8746;"),St.bigsqcup=i(k,"\\bigsqcup ","&#8852;"),St.bigvee=i(k,"\\bigvee ","&#8744;"),St.bigwedge=i(k,"\\bigwedge ","&#8743;"),St.bigodot=i(k,"\\bigodot ","&#8857;"),St.bigotimes=i(k,"\\bigotimes ","&#8855;"),St.bigoplus=i(k,"\\bigoplus ","&#8853;"),St.biguplus=i(k,"\\biguplus ","&#8846;"),St.lfloor=i(k,"\\lfloor ","&#8970;"),St.rfloor=i(k,"\\rfloor ","&#8971;"),St.lceil=i(k,"\\lceil ","&#8968;"),St.rceil=i(k,"\\rceil ","&#8969;"),St.opencurlybrace=St.lbrace=i(k,"\\lbrace ","{"),St.closecurlybrace=St.rbrace=i(k,"\\rbrace ","}"),St.lbrack=i(k,"["),St.rbrack=i(k,"]"),St.slash=i(k,"/"),St.vert=i(k,"|"),St.perp=St.perpendicular=i(k,"\\perp ","&perp;"),St.nabla=St.del=i(k,"\\nabla ","&nabla;"),St.hbar=i(k,"\\hbar ","&#8463;"),St.AA=St.Angstrom=St.angstrom=i(k,"\\text\\AA ","&#8491;"),St.ring=St.circ=St.circle=i(k,"\\circ ","&#8728;"),St.bull=St.bullet=i(k,"\\bullet ","&bull;"),St.setminus=St.smallsetminus=i(k,"\\setminus ","&#8726;"),St.not=St["¬"]=St.neg=i(k,"\\neg ","&not;"),St["…"]=St.dots=St.ellip=St.hellip=St.ellipsis=St.hellipsis=i(k,"\\dots ","&hellip;"),St.converges=St.darr=St.dnarr=St.dnarrow=St.downarrow=i(k,"\\downarrow ","&darr;"),St.dArr=St.dnArr=St.dnArrow=St.Downarrow=i(k,"\\Downarrow ","&dArr;"),St.diverges=St.uarr=St.uparrow=i(k,"\\uparrow ","&uarr;"),St.uArr=St.Uparrow=i(k,"\\Uparrow ","&uArr;"),St.to=i(C,"\\to ","&rarr;"),St.rarr=St.rightarrow=i(k,"\\rightarrow ","&rarr;"),St.implies=i(C,"\\Rightarrow ","&rArr;"),St.rArr=St.Rightarrow=i(k,"\\Rightarrow ","&rArr;"),St.gets=i(C,"\\gets ","&larr;"),St.larr=St.leftarrow=i(k,"\\leftarrow ","&larr;"),St.impliedby=i(C,"\\Leftarrow ","&lArr;"),St.lArr=St.Leftarrow=i(k,"\\Leftarrow ","&lArr;"),St.harr=St.lrarr=St.leftrightarrow=i(k,"\\leftrightarrow ","&harr;"),St.iff=i(C,"\\Leftrightarrow ","&hArr;"),St.hArr=St.lrArr=St.Leftrightarrow=i(k,"\\Leftrightarrow ","&hArr;"),St.Re=St.Real=St.real=i(k,"\\Re ","&real;"),St.Im=St.imag=St.image=St.imagin=St.imaginary=St.Imaginary=i(k,"\\Im ","&image;"),St.part=St.partial=i(k,"\\partial ","&part;"),St.infty=St.infin=St.infinity=i(k,"\\infty ","&infin;"),St.alef=St.alefsym=St.aleph=St.alephsym=i(k,"\\aleph ","&alefsym;"),St.xist=St.xists=St.exist=St.exists=i(k,"\\exists ","&exist;"),St.nexists=St.nexist=i(k,"\\nexists ","&#8708;"),St.and=St.land=St.wedge=i(k,"\\wedge ","&and;"),St.or=St.lor=St.vee=i(k,"\\vee ","&or;"),St.o=St.O=St.empty=St.emptyset=St.oslash=St.Oslash=St.nothing=St.varnothing=i(C,"\\varnothing ","&empty;"),St.cup=St.union=i(C,"\\cup ","&cup;"),St.cap=St.intersect=St.intersection=i(C,"\\cap ","&cap;"),St.deg=St.degree=i(k,"\\degree ","&deg;"),St.ang=St.angle=i(k,"\\angle ","&ang;"),St.measuredangle=i(k,"\\measuredangle ","&#8737;"),M=xt(k,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[qt]instanceof L&&!1!==t[qt].isItalic||t[qt]instanceof nt&&t[qt][qt]instanceof L&&!1!==t[qt][qt].isItalic)?(St._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),L=xt(E,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[qt]||this[qt]instanceof L||this[qt]instanceof C||"\\ "===this[qt].ctrlSeq||(t="*"+t),!this[_t]||this[_t]instanceof C||this[_t]instanceof nt||(t+="*"),t}}),Lt.p.autoCommands={_maxLength:0},jt.autoCommands=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(St[r]===F)throw'"'+r+'" is a built-in operator name';n[r]=1,i=bt(i,r.length)}return n._maxLength=i,n},j=xt(L,function(t,e){function n(t){return!t||t instanceof C||t instanceof it}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,r,o;if(e.createLeftOf.apply(this,arguments),n=t.options.autoCommands,(i=n._maxLength)>0){for(s="",r=this,o=0;r instanceof j&&r.ctrlSeq===r.letter&&i>o;)s=r.letter+s,r=r[qt],o+=1;for(;s.length;){if(n.hasOwnProperty(s)){for(o=1,r=this;o<s.length;o+=1,r=r[qt]);return Ot(r,this).remove(),t[qt]=r[qt],St[s](s).createLeftOf(t)}s=s.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==qt&&this[_t]instanceof j||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,r,o,a,l,c,h,u,f,d,p=t.autoOperatorNames;if(0!==p._maxLength){for(e=this.letter,i=this[qt];i instanceof j;i=i[qt])e=i.letter+e;for(s=this[_t];s instanceof j;s=s[_t])e+=s.letter;Ot(i[_t]||this.parent.ends[qt],s[qt]||this.parent.ends[_t]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(r=0,o=i[_t]||this.parent.ends[qt];r<e.length;r+=1,o=o[_t])for(a=gt(p._maxLength,e.length-r);a>0;a-=1)if(l=e.slice(r,r+a),p.hasOwnProperty(l)){for(c=0,h=o;a>c;c+=1,h=h[_t])h.italicize(!1),u=h;f=D.hasOwnProperty(l),o.ctrlSeq=(f?"\\":"\\operatorname{")+o.ctrlSeq,u.ctrlSeq+=f?" ":"}",R.hasOwnProperty(l)&&u[qt][qt][qt].jQ.addClass("mq-last"),n(o[qt])||o.jQ.addClass("mq-first"),n(u[_t])||(u[_t]instanceof nt?(d=u[_t],(d.siblingCreated=d.siblingDeleted=function(){d.jQ.toggleClass("mq-after-operator-name",!(d[_t]instanceof lt))})()):u.jQ.toggleClass("mq-last",!(u[_t]instanceof lt))),r+=a-1,o=u;continue t}}}}),D={},I=Lt.p.autoOperatorNames={_maxLength:9},R={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)D[s[t]]=I[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)D[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)I[n[t]]=I["arc"+n[t]]=I[n[t]+"h"]=I["ar"+n[t]+"h"]=I["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)I[i[t]]=1}(),jt.autoOperatorNames=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=bt(i,r.length)}return n._maxLength=i,n},F=xt(E,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)j(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=O();for(t=0;t<e.length;t+=1)j(e.charAt(t)).adopt(n,n.ends[_t],0);return w.succeed(n.children())}});for(N in I)I.hasOwnProperty(N)&&(St[N]=F);St.operatorname=xt(_,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return x.block.map(function(t){return t.children()})}}),St.f=xt(j,function(t,e){t.init=function(){E.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),St[" "]=St.space=i(k,"\\ ","&nbsp;"),St["'"]=St.prime=i(k,"'","&prime;"),St.backslash=i(k,"\\backslash ","\\"),Tt["\\"]||(Tt["\\"]=St.backslash),St.$=i(k,"\\$","$"),H=xt(E,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),St["@"]=H,St["&"]=i(H,"\\&","&amp;"),St["%"]=i(H,"\\%","%"),St.alpha=St.beta=St.gamma=St.delta=St.zeta=St.eta=St.theta=St.iota=St.kappa=St.mu=St.nu=St.xi=St.rho=St.sigma=St.tau=St.chi=St.psi=St.omega=xt(L,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),St.phi=i(L,"\\phi ","&#981;"),St.phiv=St.varphi=i(L,"\\varphi ","&phi;"),St.epsilon=i(L,"\\epsilon ","&#1013;"),St.epsiv=St.varepsilon=i(L,"\\varepsilon ","&epsilon;"),St.piv=St.varpi=i(L,"\\varpi ","&piv;"),St.sigmaf=St.sigmav=St.varsigma=i(L,"\\varsigma ","&sigmaf;"),St.thetav=St.vartheta=St.thetasym=i(L,"\\vartheta ","&thetasym;"),St.upsilon=St.upsi=i(L,"\\upsilon ","&upsilon;"),St.gammad=St.Gammad=St.digamma=i(L,"\\digamma ","&#989;"),St.kappav=St.varkappa=i(L,"\\varkappa ","&#1008;"),St.rhov=St.varrho=i(L,"\\varrho ","&#1009;"),St.pi=St["π"]=i(H,"\\pi ","&pi;"),St.lambda=i(H,"\\lambda ","&lambda;"),St.Upsilon=St.Upsi=St.upsih=St.Upsih=i(E,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),St.Gamma=St.Delta=St.Theta=St.Lambda=St.Xi=St.Pi=St.Sigma=St.Phi=St.Psi=St.Omega=St.forall=xt(k,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),P=xt(_,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=x.parse(this.latex);e.children().adopt(t.parent,t[qt],t[_t]),t[qt]=e.ends[_t],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[_t][_t].siblingCreated&&e.ends[_t][_t].siblingCreated(t.options,qt),e.ends[qt][qt].siblingCreated&&e.ends[qt][qt].siblingCreated(t.options,_t),t.parent.bubble("reflow")},t.parser=function(){var t=x.parse(this.latex).children();return w.succeed(t)}}),St["¹"]=i(P,"^1"),St["²"]=i(P,"^2"),St["³"]=i(P,"^3"),St["¼"]=i(P,"\\frac14"),St["½"]=i(P,"\\frac12"),St["¾"]=i(P,"\\frac34"),B=xt(C,function(t){t.init=k.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){return e!==_t?(this.jQ[0].className=!this[qt]||this[qt]instanceof C||/^[,;:\(\[]$/.test(this[qt].ctrlSeq)?"":"mq-binary-operator",this):void 0}}),St["+"]=i(B,"+","+"),St["–"]=St["-"]=i(B,"-","&minus;"),St["±"]=St.pm=St.plusmn=St.plusminus=i(B,"\\pm ","&plusmn;"),St.mp=St.mnplus=St.minusplus=i(B,"\\mp ","&#8723;"),Tt["*"]=St.sdot=St.cdot=i(C,"\\cdot ","&middot;","*"),V=xt(C,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){return t!==qt||this.strict?void e.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),U={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},$={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},St["<"]=St.lt=i(V,U,!0),St[">"]=St.gt=i(V,$,!0),St["≤"]=St.le=St.leq=i(V,U,!1),St["≥"]=St.ge=St.geq=i(V,$,!1),K=xt(C,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){return t[qt]instanceof V&&t[qt].strict?(t[qt].swap(!1),void t[qt].bubble("reflow")):void e.createLeftOf.apply(this,arguments)}}),St["="]=K,St["×"]=St.times=i(C,"\\times ","&times;","[x]"),St["÷"]=St.div=St.divide=St.divides=i(C,"\\div ","&divide;","[/]"),Tt["~"]=St.sim=i(C,"\\sim ","~","~"),G=t,W=document.createElement("div"),Y=W.style,Z={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(tt in Z)if(tt in Y){J=tt;break}J?X=function(t,e,n){t.css(J,"scale("+e+","+n+")")}:"filter"in Y?(G=function(t){t.className=t.className},X=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),r=setInterval(i),Et(window).load(function(){clearTimeout(r),i()})}):X=function(t,e,n){t.css("fontSize",n+"em")},et=xt(_,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),St.mathrm=i(et,"\\mathrm","span",'class="mq-roman mq-font"'),St.mathit=i(et,"\\mathit","i",'class="mq-font"'),St.mathbf=i(et,"\\mathbf","b",'class="mq-font"'),St.mathsf=i(et,"\\mathsf","span",'class="mq-sans-serif mq-font"'),St.mathtt=i(et,"\\mathtt","span",'class="mq-monospace mq-font"'),St.underline=i(et,"\\underline","span",'class="mq-non-leaf mq-underline"'),St.overline=St.bar=i(et,"\\overline","span",'class="mq-non-leaf mq-overline"'),St.overrightarrow=i(et,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),St.overleftarrow=i(et,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),St.textcolor=xt(_,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=w.optWhitespace,i=w.string,s=w.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),St.class=xt(_,function(t,e){t.parser=function(){var t=this,n=w.string,i=w.regex;return w.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}}),nt=xt(_,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){return t[qt]||!t.options.supSubsRequireOperand?e.createLeftOf.apply(this,arguments):void 0},t.contactWeld=function(t){var e,n,i,s,r,o;for(e=qt;e;e=e===qt&&_t)if(this[e]instanceof nt){for(n="sub";n;n="sub"===n&&"sup")i=this[n],s=this[e][n],i&&(s?i.isEmpty()?o=kt(s,0,s.ends[qt]):(i.jQ.children().insAtDirEnd(-e,s.jQ),r=i.children().disown(),o=kt(s,r.ends[_t],s.ends[qt]),e===qt?r.adopt(s,s.ends[_t],0):r.adopt(s,0,s.ends[qt])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[qt]===this&&(e===_t&&o?o[qt]?t.insRightOf(o[qt]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}},Lt.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[qt].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e);return n instanceof E?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[qt]&&!t[_t]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),O.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof E?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(qt,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=Et('<span class="mq-sup"/>').append(t.jQ.children()).attr(vt,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=Et('<span class="mq-sub"></span>').append(t.jQ.children()).attr(vt,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;2>e;e+=1)!function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var o=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=f,delete t[n].deleteOutOf,"sub"===e&&Et(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}),St.subscript=St._=xt(nt,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[qt],this.sub.upOutOf=f,e.finalizeTree.call(this)}}),St.superscript=St.supscript=St["^"]=xt(nt,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[_t],this.sup.downOutOf=f,e.finalizeTree.call(this)}}),it=xt(_,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';E.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(j("n").createLeftOf(t),K().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}
return this.ctrlSeq+"_"+t(this.ends[qt].latex())+"^"+t(this.ends[_t].latex())},t.parser=function(){var t,e=w.string,n=w.optWhitespace,i=w.succeed,s=x.block,r=this,o=r.blocks=[O(),O()];for(t=0;t<o.length;t+=1)o[t].adopt(r,r.ends[_t],0);return n.then(e("_").or(e("^"))).then(function(t){var e=o["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[_t],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[qt],this.upInto=this.ends[_t],this.ends[qt].upOutOf=this.ends[_t],this.ends[_t].downOutOf=this.ends[qt]}}),St["∑"]=St.sum=St.summation=i(it,"\\sum ","&sum;"),St["∏"]=St.prod=St.product=i(it,"\\prod ","&prod;"),St.coprod=St.coproduct=i(it,"\\coprod ","&#8720;"),St["∫"]=St.int=St.integral=xt(it,function(t,e){t.init=function(){E.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=_.p.createLeftOf}),st=St.frac=St.dfrac=St.cfrac=St.fraction=xt(_,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[_t].upOutOf=this.ends[qt],this.downInto=this.ends[qt].downOutOf=this.ends[_t]}}),rt=St.over=Tt["/"]=xt(st,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[qt];i&&!(i instanceof C||i instanceof(St.text||t)||i instanceof it||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[qt];i instanceof it&&i[_t]instanceof nt&&(i=i[_t],i[_t]instanceof nt&&i[_t].ctrlSeq!=i.ctrlSeq&&(i=i[_t])),i!==e[qt]&&(this.replaces(Ot(i[_t]||e.parent.ends[qt],e[qt])),e[qt]=i)}n.createLeftOf.call(this,e)}}),ot=St.sqrt=St["√"]=xt(_,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return x.optBlock.then(function(t){return x.block.map(function(e){var n=at();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[_t].jQ;X(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),St.vec=xt(_,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),at=St.nthroot=xt(ot,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[qt].latex()+"]{"+this.ends[_t].latex()+"}"}}),lt=xt(xt(_,d),function(e,n){e.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,m,[e,i]),this.side=t,this.sides={},this.sides[qt]={ch:e,ctrlSeq:s},this.sides[_t]={ch:i,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===_t?" mq-ghost":"")+'">'+this.sides[qt].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===qt?" mq-ghost":"")+'">'+this.sides[_t].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[qt].ctrlSeq+this.ends[qt].latex()+"\\right"+this.sides[_t].ctrlSeq},e.oppBrack=function(t,e,n){return e instanceof lt&&e.side&&e.side!==-n&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||ct[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[qt].ch]===e.sides[_t].ch)&&e},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===qt?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){var e,i,s;this.replacedFragment||(e=t.options,i=this.oppBrack(e,t[qt],qt)||this.oppBrack(e,t[_t],_t)||this.oppBrack(e,t.parent.parent)),i?(s=this.side=-i.side,this.closeOpposing(i),i===t.parent.parent&&t[s]&&(Ot(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow"))):(i=this,s=i.side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(Ot(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t)),s===qt?t.insAtLeftEnd(i.ends[qt]):t.insRightOf(i)},e.placeCursor=t,e.unwrap=function(){this.ends[qt].children().disown().adopt(this.parent,this,this[_t]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i,s,r,o=this.parent,a=this[t],l=o.ends[t];if(t===this.side)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));if(i=n.options,s=!this.side,this.side=-t,this.oppBrack(i,this.ends[qt].ends[this.side],t))this.closeOpposing(this.ends[qt].ends[this.side]),r=this.ends[qt].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),a?n.insDirOf(-t,a):n.insAtDirEnd(t,o);else{if(this.oppBrack(i,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));this.sides[t]={ch:ct[this.sides[this.side].ch],ctrlSeq:ct[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===qt?0:1).addClass("mq-ghost").html(this.sides[t].ch)}a?(r=this.ends[qt].ends[t],Ot(a,l,-t).disown().withDirAdopt(-t,this.ends[qt],r,0).jQ.insAtDirEnd(t,this.ends[qt].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,a)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[qt])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[qt].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===qt?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),ct={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"},p("("),p("["),p("{","\\{"),St.langle=i(lt,qt,"&lang;","&rang;","\\langle ","\\rangle "),St.rangle=i(lt,_t,"&lang;","&rang;","\\langle ","\\rangle "),Tt["|"]=i(lt,qt,"|","|","|","|"),St.left=xt(_,function(t){t.parser=function(){var t=w.regex,e=w.string,n=(w.succeed,w.optWhitespace);return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return x.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=lt(0,s,e,i,t);return n.blocks=[r],r.adopt(n,0,0),n})})})}}),St.right=xt(_,function(t){t.parser=function(){return w.fail("unmatched \\right")}}),ht=St.binom=St.binomial=xt(xt(_,d),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),St.choose=xt(ht,function(t){t.createLeftOf=rt.prototype.createLeftOf}),St.editable=St.MathQuillMathField=xt(_,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=w.string,i=w.regex,s=w.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){var t=At(this.ends[qt],this.jQ,Lt());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),h(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[qt].controller))},t.latex=function(){return this.ends[qt].latex()},t.text=function(){return this.ends[qt].text()}}),ut=St.embed=xt(E,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=w.string,regex=w.regex,succeed=w.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(n){return t.setOptions(It[e](n))})})}}),Tt["\\"]=xt(_,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[qt].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[qt].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[qt].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?k(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[qt].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return Et(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[qt].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[_t]?t.insLeftOf(this[_t]):t.insAtRightEnd(this.parent),e=this.ends[qt].latex(),e||(e=" "),n=St[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=T(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),ft=c(1);for(dt in ft)!function(t,e){"function"==typeof e?(l[t]=function(){return a(),e.apply(this,arguments)},l[t].prototype=e.prototype):l[t]=e}(dt,ft[dt])}(),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TalqsMathInput=e()}(this,function(){"use strict";for(var t={EXP_2:{fn:"write",value:"^2"},EXP_3:{fn:"write",value:"^3"},EXP:{fn:"cmd",value:"^"},LT:{fn:"write",value:"<"},LEQ:{fn:"write",value:"\\le"},FRAC_INCLUSIVE:{fn:"write",value:"\\frac{}{}",keystroke:{Left:1}},GT:{fn:"write",value:">"},GEQ:{fn:"write",value:"\\ge"},PI:{fn:"cmd",value:"pi"},PARENS:{fn:"write",value:"\\left(\\right)",keystroke:{Left:1}},BRACKETS:{fn:"write",value:"\\left[\\right]",keystroke:{Left:1}},DEGREE:{fn:"cmd",value:"\\degree"},COLON:{fn:"write",value:":"},COMMA:{fn:"write",value:","},PERCENT:{fn:"write",value:"\\%"},PLUS:{fn:"write",value:"+"},MINUS:{fn:"write",value:"-"},NEQ:{fn:"write",value:"\\ne"},TIMES:{fn:"write",value:"\\times"},DIVIDE:{fn:"write",value:"\\div"},EQUAL:{fn:"write",value:"="},DECIMAL:{fn:"write",value:"."},BACKSPACE:{fn:"keystroke",value:"Backspace"},DISMISS:{},SHIFT_NUM:{},LEFT:{fn:"keystroke",value:"Left"},RIGHT:{fn:"keystroke",value:"Right"}},e=0;e<10;e++)t["NUM_"+e]={fn:"write",value:e};var n={};for(var i in t)n[i]=i;var s=n,r=t,o=window.MathQuill,a={NONE:"NONE",IN_PARENS:"IN_PARENS",IN_SUPER_SCRIPT:"IN_SUPER_SCRIPT",IN_SUB_SCRIPT:"IN_SUB_SCRIPT",IN_NUMERATOR:"IN_NUMERATOR",IN_DENOMINATOR:"IN_DENOMINATOR",BEFORE_FRACTION:"BEFORE_FRACTION"},l=["0","1","2","3","4","5","6","7","8","9"],c=["\\theta","\\pi"],h=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],u=l.concat(c,h.map(function(t){return t.toLowerCase()}),h.map(function(t){return t.toUpperCase()}));Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;for(var s=0|e,r=Math.max(s>=0?s:i-Math.abs(s),0);r<i;){if(function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}(n[r],t))return!0;r++}return!1}});var f=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.MQ=o.getInterface(2),this.mathField=this.MQ.MathField(t,{substituteTextarea:function(){return document.createElement("span")}}),this.callbacks=n};f.prototype.focus=function(){var t=this.mathField.__controller;t.cursor.show(),t.blurred=!1},f.prototype.blur=function(){var t=this.mathField.__controller;t.cursor.hide(),t.blurred=!0},f.prototype.handleExponent=function(t,e,n,i){var s=t[this.MQ.L],r=0===s;if(this.mathField[n](i),r){var o=/^EXP_\d/.test(e)?3:2;this.keystroke("Left",o)}},f.prototype.keystroke=function(t,e){for(var n=this;e--;)n.mathField.keystroke(t)},f.prototype.pressKey=function(t,e){var n=this,i=this.mathField.__controller.cursor,o=r[t]||{},a=o.fn,l=o.value,c=o.keystroke;if([s.EXP,s.EXP_2,s.EXP_3].indexOf(t)>=0)this.handleExponent(i,t,a,l);else if(o&&a){var h=i[this.MQ.L].ctrlSeq;if(e)if(/^NUM_\d/.test(t))l="①②③④⑤⑥⑦⑧⑨"[l-1]||"";else if(t===s.DECIMAL)return;if(this.mathField[a](l),t!==s.BACKSPACE||"\\ge "!==h&&"\\le "!==h||this.mathField[a](l),c)for(var u in c){var l=c[u]||0;n.keystroke(u,l)}}return i.selection||i.show(),this.callbacks.onSelectionChanged&&this.callbacks.onSelectionChanged(i.selection),{context:this.contextForCursor(i)}},f.prototype.setCursorPosition=function(t,e,n){var i=n||document.elementFromPoint(t,e);if(i){var s=this.getCursor();if(i.hasAttribute("mq-root-block"))s.insAtRightEnd(this.mathField.__controller.root);else{var r=this.mathField.__controller,o=t-document.body.scrollLeft,a=e-document.body.scrollTop;r.seek($(i),o,a).cursor.startSelection();var l=this._maybeFindCommand(s[this.MQ.L]);l&&l.endNode&&(s.insLeftOf(l.endNode),this.mathField.keystroke("Right"))}this.callbacks.onCursorMove&&this.callbacks.onCursorMove({context:this.contextForCursor(s)})}},f.prototype.getCursor=function(){return this.mathField.__controller.cursor},f.prototype.getSelection=function(){return this.getCursor().selection},f.prototype.getContent=function(){return this.mathField.latex()},f.prototype.setContent=function(t){this.mathField.latex(t)},f.prototype.isEmpty=function(){var t=this.getCursor();return 1===t.parent.id&&0===t[1]&&0===t[-1]},f.prototype._maybeFindCommand=function(t){var e=this;if(!t)return null;for(var n,i,s=/^[a-z]$/,r=/^\\[a-z]$/,o=["\\log","\\ln","\\cos","\\sin","\\tan"],a="",l=t;0!==l;){var c=l.ctrlSeq.trim();if(!s.test(c)){if(r.test(c)){a=c+a,n=l;break}break}a=c+a,l=l[e.MQ.L]}if(n){for(l=t[this.MQ.R];0!==l;){var h=l.ctrlSeq.trim();if(s.test(h))a+=h;else if("\\left("===h){i=l;break}l=l[e.MQ.R]}return o.includes(a)?{name:a,startNode:n,endNode:i}:null}return null},f.prototype._maybeFindCommandBeforeParens=function(t){return this._maybeFindCommand(t[this.MQ.L])},f.prototype._isFraction=function(t){return t.jQ&&t.jQ.hasClass("mq-fraction")},f.prototype._isNumerator=function(t){return t.jQ&&t.jQ.hasClass("mq-numerator")},f.prototype._isDenominator=function(t){return t.jQ&&t.jQ.hasClass("mq-denominator")},f.prototype._isSubScript=function(t){return t.jQ&&(t.jQ.hasClass("mq-sub-only")||t.jQ.hasClass("mq-sub"))},f.prototype._isSuperScript=function(t){return t.jQ&&(t.jQ.hasClass("mq-sup-only")||t.jQ.hasClass("mq-sup"))},f.prototype._isParens=function(t){return t&&"\\left("===t.ctrlSeq},f.prototype._isLeaf=function(t){return t&&t.ctrlSeq&&u.includes(t.ctrlSeq.trim())},f.prototype.contextForCursor=function(t){for(var e=this,n=t;0!==n[this.MQ.R];){if(e._isFraction(n[e.MQ.R]))return a.BEFORE_FRACTION;if(!e._isLeaf(n[e.MQ.R]))break;n=n[e.MQ.R]}return this._isParens(t.parent&&t.parent.parent)?a.IN_PARENS:this._isNumerator(t.parent)?a.IN_NUMERATOR:this._isDenominator(t.parent)?a.IN_DENOMINATOR:this._isSubScript(t.parent)?a.IN_SUB_SCRIPT:this._isSuperScript(t.parent)?a.IN_SUPER_SCRIPT:a.NONE};var d=function(t,e){this.mathContainer=t,this.config=e||{},this.mathField=new f(this.mathContainer,{},{}),this.mathField.mathField.__controller.container.unbind("mousedown.mathquill"),this.mathField.mathField.__controller.scrollHoriz=function(){},this.state={focused:!1,disabled:!1},this._root=this.mathContainer.querySelector(".mq-root-block"),t.addEventListener("touchstart",this.handleTouchStart.bind(this))},p={disabled:{},focused:{},value:{}};return p.disabled.set=function(t){this.state.disabled=t},p.disabled.get=function(){return this.state.disabled},p.focused.get=function(){return this.state.focused},p.value.get=function(){return this.mathField.getContent()},p.value.set=function(t){return this.mathField.setContent(t||"")},d.prototype._insertCursorAtClosestNode=function(t,e){var n=this.mathField.getCursor();if(!this._root.hasChildNodes())return void n.insAtLeftEnd(this.mathField.mathField.__controller.root);e>this._containerBounds.bottom?e=this._containerBounds.bottom:e<this._containerBounds.top&&(e=this._containerBounds.top+10);var i;i=-8;if(!this._findHitNode(this._containerBounds,t,e,5,i)&&(e=this._containerBounds.top,i=8,!this._findHitNode(this._containerBounds,t,e,5,i))){var s=this._root.firstChild.getBoundingClientRect(),r=this._root.lastChild.getBoundingClientRect(),o=s.left,a=r.right;Math.abs(t-a)<Math.abs(t-o)?n.insAtRightEnd(this.mathField.mathField.__controller.root):n.insAtLeftEnd(this.mathField.mathField.__controller.root)}},d.prototype._findHitNode=function(t,e,n,i,s){for(var r=this;n>=t.top&&n<=t.bottom;){var o=function(){n+=s;var t=[[e-i,n],[e,n],[e+i,n]],o=t.map(function(t){return document.elementFromPoint.apply(document,t)}).filter(function(t){return t&&r._root.contains(t)&&(!t.classList.contains("mq-root-blocks")&&!t.classList.contains("mq-non-leafs")||t.classList.contains("mq-emptys")||t.classList.contains("mq-hasCursors"))}),a=null,l=[],c=[],h=0,u={},f={};o.forEach(function(t){var e=t.getAttribute("mathquill-command-id");null!=e?(l.push(t),u[e]=(u[e]||0)+1,f[e]=t):c.push(t)});var d=[];for(var p in u)d.push([p,u[p]]);if(d.forEach(function(t){var e=t[0],n=t[1];n>h&&(h=n,a=f[e])}),null==a&&c.length>0&&(a=c[0]),null!==a)return r.mathField.setCursorPosition(e,n,a),{v:!0}}();if(o)return o.v}return!1},d.prototype.handleTouchStart=function(t){if(!this.state.disabled){if(""!==this.mathField.getContent()){this._containerBounds=this.mathContainer.getBoundingClientRect();var e=t.changedTouches[0];this._insertCursorAtClosestNode(e.clientX,e.clientY)}this.state.focused||this.focus()}},d.prototype.blur=function(){this.mathField.blur(),this.state.focused=!1,this.config.onBlur&&this.config.onBlur()},d.prototype.focus=function(){this.mathField.focus(),this.state.focused=!0,this.config.onFocus&&this.config.onFocus()},d.prototype.pressKey=function(t,e){var n=this.value;this.mathField.pressKey(t,e);var i=this.mathField.getContent();this.config.onChange&&n!==i&&this.config.onChange(i)},Object.defineProperties(d.prototype,p),d}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TalqsMathKeypad=e()}(this,function(){"use strict";for(var t={ITEM:"flex-item",NUM:"flex-item-number",CIRCLE:"flex-item-circle",NO_CIRCLE:"flex-item-nocircle",MOVE:"arrow-move",ACTIVE:"flex-item-active",NUMBER_SHIFT:"flex-gn-active",NUM_PAD:"flex-group-number",WRAPPER:"mathpad-wrap",WRAPPER_FLEX:"mathpad-wrap-flex"},e={EXP_2:{fn:"write",value:"^2"},EXP_3:{fn:"write",value:"^3"},EXP:{fn:"cmd",value:"^"},LT:{fn:"write",value:"<"},LEQ:{fn:"write",value:"\\le"},FRAC_INCLUSIVE:{fn:"write",value:"\\frac{}{}",keystroke:{Left:1}},GT:{fn:"write",value:">"},GEQ:{fn:"write",value:"\\ge"},PI:{fn:"cmd",value:"pi"},PARENS:{fn:"write",value:"\\left(\\right)",keystroke:{Left:1}},BRACKETS:{fn:"write",value:"\\left[\\right]",keystroke:{Left:1}},DEGREE:{fn:"cmd",value:"\\degree"},COLON:{fn:"write",value:":"},COMMA:{fn:"write",value:","},PERCENT:{fn:"write",value:"\\%"},PLUS:{fn:"write",value:"+"},MINUS:{fn:"write",value:"-"},NEQ:{fn:"write",value:"\\ne"},TIMES:{fn:"write",value:"\\times"},DIVIDE:{fn:"write",value:"\\div"},EQUAL:{fn:"write",value:"="},DECIMAL:{fn:"write",value:"."},BACKSPACE:{fn:"keystroke",value:"Backspace"},DISMISS:{},SHIFT_NUM:{},LEFT:{fn:"keystroke",value:"Left"},RIGHT:{fn:"keystroke",value:"Right"}},n=0;n<10;n++)e["NUM_"+n]={fn:"write",value:n};var i={};for(var s in e)i[s]=s;var r=i,o={EXP:'\n<svg  width="19" height="23" viewBox="0 0 19 23">\n    <defs>\n        <rect id="a" width="6" height="8" x="13" rx="2"/>\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n        <use fill="#FFFEF7" xlink:href="#a"/>\n        <rect width="5" height="7" x="13.5" y=".5" stroke="#8B572A" rx="2"/>\n        <rect width="12" height="16" y="7" fill="#FFFEF7" rx="2"/>\n        <path fill="#8B572A" d="M1.76 7h2.86v1H1.942L1.76 7zm5.264 0h2v1h-2V7zm-2 15h2.264v1H5.024v-1zm5.055.012c.259-.062.436-.125.53-.189.095-.063.198-.19.31-.378l.886.467c-.172.34-.402.6-.69.78-.288.179-.615.277-.98.293l-.056-.973zm-8.483-.11c.115.06.222.092.32.098.099.006.556.006 1.372 0v1c-.686.013-1.169.006-1.448-.019-.278-.025-.5-.082-.667-.17l.423-.91zM11.024 11h1v2h-1v-2zm0-3.78c.423.31.686.57.791.78.105.21.174.543.209 1h-1c-.015-.291-.05-.483-.103-.577-.054-.093-.195-.207-.423-.34l.526-.863zm0 7.78h1v2h-1v-2zm0 3.6h1v1.5h-1v-1.5zm-11-6.6h1v2h-1v-2zM.19 8.203l.935.386a.734.734 0 0 0-.1.296c-.005.086-.005.52 0 1.301H.02c-.027-.665-.027-1.14 0-1.424.026-.285.083-.471.17-.56zM.024 16h1v2.18h-1V16zm0 4h1v1.18l-1 .31V20z"/>\n    </g>\n</svg>\n',EXP_2:'\n<svg width="20" height="24">\n  <g fill="none" fill-rule="evenodd">\n    <path fill="#8B572A" d="M13.4 3h1c0-.6.3-1 .6-1.3.4-.3.8-.5 1.4-.5.5 0 1 .2 1.2.5.4.2.6.6.6 1s0 .8-.3 1c-.3.4-.7 1-1.3 1.5l-3.2 3.3v.7h6v-1H15L17.3 6C18 5 18.6 4.4 19 4c0-.4.3-.8.3-1.3 0-.7-.3-1.3-1-1.8-.4-.5-1-.8-2-.8-.8 0-1.5.3-2 .8-.6.5-1 1.2-1 2z"/>\n    <rect width="12" height="16" y="8" fill="#FFFEF7" rx="2"/>\n    <rect width="12" height="16" y="8" fill="#FFFEF7" rx="2"/>\n    <path fill="#8B572A" d="M1.8 8h2.8v1H2l-.2-1zM7 8h2v1H7V8zM5 23h2.3v1H5v-1zm5 0c.3 0 .5 0 .6-.2l.3-.4.8.5-.7.7c-.2.2-.5.3-1 .3v-1zm-8.4 0h1.6v1H1.8c-.2 0-.5 0-.6-.2l.4-1zM11 12h1v2h-1v-2zm0-3.8l.8.8.2 1h-1v-.6l-.5-.3.5-.8zm0 7.8h1v2h-1v-2zm0 3.6h1V21h-1v-1.4zM0 13h1v2H0v-2zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V11H0V9.8c0-.3 0-.5.2-.6zM0 17h1v2.2H0V17zm0 4h1v1.2l-1 .3V21z"/>\n  </g>\n</svg>\n\n',EXP_3:'\n<svg width="20" height="24">\n  <g fill="none" fill-rule="evenodd">\n    <path fill="#8B572A" d="M15.3 5h1c.7 0 1.2.2 1.6.5.2.3.4.7.4 1.2s-.2 1-.6 1.2c-.3.2-.8.3-1.3.3-.6 0-1 0-1.4-.4a1.6 1.6 0 0 1-.5-1.2h-1c0 .7.3 1.3.8 1.8.6.4 1.3.6 2.2.6.8 0 1.5-.2 2-.7.7-.4 1-1 1-1.8 0-.6-.2-1-.6-1.5-.5-.4-1-.6-1.6-.6.5 0 1-.4 1.2-.7.3-.5.5-1 .5-1.5a2 2 0 0 0-.7-1.6c-.5-.5-1-.8-2-.8-.7 0-1.3.3-1.8.7-.5.3-.8 1-1 1.7h1.2c0-.5.2-.8.5-1 .3-.4.7-.5 1.2-.5s1 0 1.2.4c.3.3.4.6.4 1 0 .5 0 .8-.4 1-.3.4-.7.6-1.2.6h-1v1z"/>\n    <rect width="12" height="16" y="8" fill="#FFFEF7" rx="2"/>\n    <rect width="12" height="16" y="8" fill="#FFFEF7" rx="2"/>\n    <path fill="#8B572A" d="M1.8 8h2.8v1H2l-.2-1zM7 8h2v1H7V8zM5 23h2.3v1H5v-1zm5 0c.3 0 .5 0 .6-.2l.3-.4.8.5-.7.7c-.2.2-.5.3-1 .3v-1zm-8.4 0h1.6v1H1.8c-.2 0-.5 0-.6-.2l.4-1zM11 12h1v2h-1v-2zm0-3.8l.8.8.2 1h-1v-.6l-.5-.3.5-.8zm0 7.8h1v2h-1v-2zm0 3.6h1V21h-1v-1.4zM0 13h1v2H0v-2zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V11H0V9.8c0-.3 0-.5.2-.6zM0 17h1v2.2H0V17zm0 4h1v1.2l-1 .3V21z"/>\n  </g>\n</svg>\n\n',FRAC_INCLUSIVE:'\n<svg width="15" height="31">\n  <g fill="none" fill-rule="evenodd">\n    <path fill="#FFFEF7" d="M4 0h7a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 18h7a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2z"/>\n    <path fill="#8B572A" d="M.8 16H.2l-.2-.5.2-.4h14.6l.2.5-.2.4H.8zm3-16H6v1H4l-.3-1zM8 0h2v1H8V0zM7 12h2.3v1H7v-1zm4 0c.3 0 .5 0 .6-.2l.3-.4.8.5-.7.7c-.2.2-.5.3-1 .3v-1zm-7.4 0h1.6v1H3.8c-.3 0-.5 0-.6-.2l.4-1zM12 4h1v2h-1V4zm0-3.8l.8.8.2 1h-1v-.6c-.2 0-.3-.2-.5-.3l.5-.8zM12 8h1v2h-1V8zM2 5h1v2H2V5zm.2-3.8l1 .4A.7.7 0 0 0 3 2V3H2V1.8c0-.3 0-.5.2-.6zM2 9h1v2.2H2V9zm1.7 9H6v1H4l-.3-1zM8 18h2v1H8v-1zM7 30h2.3v1H7v-1zm4 0c.3 0 .5 0 .6-.2l.3-.4.8.5-.7.7c-.2.2-.5.3-1 .3v-1zm-7.4 0h1.6v1H3.8c-.3 0-.5 0-.6-.2l.4-1zm8.4-8h1v2h-1v-2zm0-3.8l.8.8.2 1h-1v-.6c-.2 0-.3-.2-.5-.3l.5-.8zm0 7.8h1v2h-1v-2zM2 23h1v2H2v-2zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V21H2v-1.4c0-.3 0-.5.2-.6zM2 27h1v2.2H2V27z"/>\n  </g>\n</svg>\n\n',PARENS:'\n<svg width="32" height="24">\n  <g fill="none" fill-rule="evenodd">\n    <rect width="14" height="24" x="9" fill="#FFFEF7" rx="2"/>\n    <path fill="#8B572A" d="M3.4 2H5a20 20 0 0 0-2.2 4.4c-.7 2-1 3.8-1 5.6 0 1.8.3 3.7 1 5.6C3.3 19 4 20.6 5 22H3.4A18.4 18.4 0 0 1 1 17.6 15.7 15.7 0 0 1 0 12c0-2 .3-3.7 1-5.6A17.6 17.6 0 0 1 3.4 2zM27 2h1.6A19.3 19.3 0 0 1 31 6.4c.7 2 1 3.7 1 5.6 0 2-.3 3.7-1 5.6a20.2 20.2 0 0 1-2.4 4.4H27a22.2 22.2 0 0 0 2.2-4.4c.7-2 1-3.8 1-5.6 0-1.8-.3-3.7-1-5.6A21 21 0 0 0 27 2zM10.8 0H13v1h-2l-.2-1zM15 0h1.5v1H15V0zm3 0h2v1h-2V0zm-4 23h2.3v1H14v-1zm4 0h2.3v1H18v-1zm3 0c.4 0 .5-.2.6-.2l.3-.4.8.5c0 .2-.4.5-.7.6-.2.2-.5.3-.8.3v-1zm-10.5 0h1.7v1h-1.4l-.7-.2.5-1zM22 4h1v2h-1V4zm0-3.8l.8.8.2 1h-1v-.6l-.5-.3.5-.8zM22 8h1v2h-1V8zm0 4h1v2h-1v-2zm0 4h1v2h-1v-2zm0 4h1v1h-1v-1zM9 5h1v2H9V5zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V3H9V1.8c0-.3 0-.5.2-.6zM9 9h1v2.2H9V9zm0 4h1v2.2H9V13zm0 4h1v2.2H9V17zm0 4h1v1H9v-1z"/>\n  </g>\n</svg>\n',BRACKETS:'\n<svg width="32" height="24">\n  <g fill="none" fill-rule="evenodd">\n    <path fill="#8B572A" d="M27 1v1.4h3.5v17.2H27V21h5V1zM0 1v20h5v-1.4H1.5V2.4H5V1z"/>\n    <rect width="14" height="24" x="9" fill="#FFFEF7" rx="2"/>\n    <path fill="#8B572A" d="M10.8 0H13v1h-2l-.2-1zM15 0h1.5v1H15V0zm3 0h2v1h-2V0zm-4 23h2.3v1H14v-1zm4 0h2.3v1H18v-1zm3 0c.4 0 .5-.2.6-.2l.3-.4.8.5c0 .2-.4.5-.7.6-.2.2-.5.3-.8.3v-1zm-10.5 0h1.7v1h-1.4l-.7-.2.5-1zM22 4h1v2h-1V4zm0-3.8l.8.8.2 1h-1v-.6l-.5-.3.5-.8zM22 8h1v2h-1V8zm0 4h1v2h-1v-2zm0 4h1v2h-1v-2zm0 4h1v1h-1v-1zM9 5h1v2H9V5zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V3H9V1.8c0-.3 0-.5.2-.6zM9 9h1v2.2H9V9zm0 4h1v2.2H9V13zm0 4h1v2.2H9V17zm0 4h1v1H9v-1z"/>\n  </g>\n</svg>\n\n',DEGREE:'\n<svg width="19" height="21">\n  <g fill="none" fill-rule="evenodd">\n    <path fill="#8B572A" d="M15.7 0c.8 0 1.4.3 2 .8.4.5.7 1.2.7 2S18 4 17.6 4.5a2.6 2.6 0 0 1-2 .8 2.6 2.6 0 0 1-1.8-.8 2.6 2.6 0 0 1-.8-2c0-.6.3-1.3.8-1.8a2.5 2.5 0 0 1 2-.8zm0 1a1.6 1.6 0 0 0-1.2.5c-.3.3-.5.7-.5 1.2s.2 1 .5 1.2c.3.2.7.4 1.2.4s1-.2 1.2-.5a1.7 1.7 0 0 0 .4-1.3c0-.5-.2-1-.5-1.2a1.7 1.7 0 0 0-1.3-.5z"/>\n    <rect width="11" height="13" y="8" fill="#FFFEF7" rx="2"/>\n    <path fill="#8B572A" d="M1.8 8H4v1H2l-.2-1zM6 8h2v1H6V8zM5 20h2.3v1H5v-1zm4 0c.3 0 .5 0 .6-.2l.3-.4.8.5-.7.7c-.2.2-.5.3-1 .3v-1zm-7.4 0h1.6v1H1.8c-.2 0-.5 0-.6-.2l.4-1zm8.4-8h1v2h-1v-2zm0-3.8l.8.8.2 1h-1v-.6L9.4 9l.5-.8zm0 7.8h1v2h-1v-2zM0 13h1v2H0v-2zm.2-3.8l1 .4a.7.7 0 0 0-.2.3V11H0V9.8c0-.3 0-.5.2-.6zM0 17h1v2.2H0V17z"/>\n  </g>\n</svg>\n\n',DISMISS:'\n<svg width="32" height="24">\n  <path fill="#8B572A" d="M30.7 0c.7 0 1.3.6 1.3 1.3v12.4c0 .7-.6 1.3-1.3 1.3H1.3A1.3 1.3 0 0 1 0 13.7V1.3C0 .6.6 0 1.3 0h29.4zM1 1v13h30V1H1zm26 2h2v2.2h-2v-2zm-3.4 0h2v2.2h-2v-2zm-3.4 0h2v2.2h-2v-2zm-3.5 0h2v2.2h-2v-2zm-3.4 0h2v2.2h-2v-2zM9.8 3h2v2.2h-2v-2zM6.4 3h2v2.2h-2v-2zM3 3h2v2.2H3v-2zm24 3.7h2v2h-2v-2zm-3.4 0h2v2h-2v-2zm-3.4 0h2v2h-2v-2zm-3.5 0h2v2h-2v-2zm-3.4 0h2v2h-2v-2zm-3.5 0h2v2h-2v-2zm-3.4 0h2v2h-2v-2zM3 6.7h2v2H3v-2zm24 3.7h2v2h-2v-2zm-3.4 0h2v2h-2v-2zm-13.8 0h12.4v2H9.8v-2zm-3.4 0h2v2h-2v-2zm-3.4 0h2v2H3v-2zm7.3 8l-.5.4c.3-.2.8-.2 1 0l5 3.6c.2.2.7.2 1 0l5-3.6c.2-.2.7-.2 1 0l-.6-.4c.6.4.7 1 0 1.6l-5 3.6c-.5.4-1.4.4-2 0l-5-3.6c-.6-.5-.5-1.2 0-1.5z"/>\n</svg>\n\n',LEFT:'\n<svg width="18" height="10">\n  <path fill="#8B572A" fill-rule="evenodd" d="M18 5c0 .2 0 .4-.2.5l-.6.2H2.7l3.2 3c.3.4.3.7 0 1-.4.4-.7.4-1 0L0 5.5 0 5.3V5v-.3l.2-.2L4.7.3c.4-.4.7-.4 1 0 .4.3.4.6 0 1l-3 3h14.6c.2 0 .3 0 .5.2l.2.5z"/>\n</svg>\n',RIGHT:'\n<svg  width="18" height="10">\n  <path fill="#8B572A" fill-rule="evenodd" d="M0 5c0-.2 0-.4.2-.5l.6-.2h14.6l-3.2-3c-.3-.4-.3-.7 0-1 .4-.4.7-.4 1 0L18 4.5l.2.2v.6l-.2.2-4.5 4.2c-.4.4-.7.4-1 0-.4-.3-.4-.6 0-1l3-3H.8c-.2 0-.3 0-.5-.2L0 5z"/>\n</svg>\n',BACKSPACE:'\n<svg width="24" height="14">\n  <path fill="#8B572A" fill-rule="nonzero" d="M15 6l2-2c.2-.2.6-.2 1 0v1l-2.2 2 2 2c.3.3.3.7 0 1-.2.2-.6.2-1 0l-2-2-2 2c-.2.2-.6.2-1 0V9L14 7l-2-2c-.3-.3-.3-.7 0-1 .2-.2.6-.2.8 0l2 2zM7.2 1C8 .3 9 0 9.7 0H21c1.6 0 3 1 3 2.5v9c0 1.4-1.4 2.5-3 2.5H9.7c-.8 0-1.8-.3-2.4-.8L.7 7.8C0 7.4 0 6.6.7 6.2L7.3.8zM1.5 7l6.7 5.5c.4.2 1 .4 1.5.4H21c1 0 1.7-.7 1.7-1.5v-9C22.7 1.7 22 1 21 1H9.7c-.5 0-1 .3-1.5.5L1.5 7z"/>\n</svg>\n'},a="data-key-type",l={KEY:a,NUM_PAD:"data-num-pad"},c={KEY:"["+a+"]",NUM_PAD:"[data-num-pad]"},h=l,u=c,f=[{name:"symbol",list:[[{svg:o.EXP_2,key:r.EXP_2},{svg:o.EXP_3,key:r.EXP_3},{svg:o.EXP,key:r.EXP}],[{text:"<",key:r.LT},{text:"≤",key:r.LEQ},{key:r.FRAC_INCLUSIVE,svg:o.FRAC_INCLUSIVE}],[{text:">",key:r.GT},{text:"≥",key:r.GEQ},{text:"π",key:r.PI}],[{key:r.PARENS,svg:o.PARENS},{key:r.BRACKETS,svg:o.BRACKETS},{key:r.DEGREE,svg:o.DEGREE}],[{text:":",key:r.COLON},{text:",",key:r.COMMA},{text:"%",key:r.PERCENT}]]},{name:"number",hook:h.NUM_PAD,list:[[{text:"1",key:r.NUM_1},{text:"5",key:r.NUM_5},{text:"9",key:r.NUM_9}],[{text:"2",key:r.NUM_2},{text:"6",key:r.NUM_6},{text:"0",key:r.NUM_0,style:t.NO_CIRCLE}],[{text:"3",key:r.NUM_3},{text:"7",key:r.NUM_7},{text:".",key:r.DECIMAL,style:t.NO_CIRCLE}],[{text:"4",key:r.NUM_4},{text:"8",key:r.NUM_8},{style:t.CIRCLE,group:[{text:"1",key:r.SHIFT_NUM}]}],[{text:"+",key:r.PLUS},{text:"-",key:r.MINUS},{text:"≠",key:r.NEQ}],[{text:"×",key:r.TIMES},{text:"÷",key:r.DIVIDE},{text:"=",key:r.EQUAL}]]},{name:"calculate",list:[[{svg:o.BACKSPACE,key:r.BACKSPACE},{style:t.MOVE,group:[{svg:o.LEFT,key:r.LEFT},{svg:o.RIGHT,key:r.RIGHT}]},{svg:o.DISMISS,key:r.DISMISS}]]}],d={PRIMARY:f},p=d.PRIMARY,m=function(e){var n=/\d|\./.test(e.text)?t.NUM+" "+(e.style||""):e.style;return"<span "+(n?'class="'+n+'"':"")+">"+(e.text||"")+"</span>"},v=function(t){return"<div "+h.KEY+'="'+t.key+'">\n                '+(t.svg||m(t))+"\n            </div>"},g='\n    <div class="'+t.WRAPPER+'">\n        <div class="'+t.WRAPPER_FLEX+'">\n           '+function(){var t="";return p.forEach(function(e){t+='<ul class="flex-group flex-group-'+e.name+'" '+(e.hook||"")+">",e.list.forEach(function(e){t+='<li class="flex-item">',e.forEach(function(e){if(e.group){var n=e.style?'class="'+e.style+'"':"";t+="<div "+n+">",e.group.forEach(function(e){t+=v(e)}),t+="</div>"}else t+=v(e)}),t+="</li>"}),t+="</ul>"}),t}()+"\n        </div>\n    </div>";return function(e,n){e.innerHTML=g;var i=e.querySelectorAll(u.KEY),s=e.querySelector(u.NUM_PAD);this._config=n||{},this._shiftNumberState=!1;var o=this._config.press,a=this._config.dismiss,l=this;[].forEach.call(i,function(e){e.addEventListener("touchstart",function(e){e.stopPropagation(),this.classList.add(t.ACTIVE);var n=this.getAttribute(h.KEY);n===r.DISMISS&&a?a():n===r.SHIFT_NUM?(l._shiftNumberState=!l._shiftNumberState,s.classList.toggle(t.NUMBER_SHIFT,l._shiftNumberState)):o&&o(n,l._shiftNumberState)}),e.addEventListener("touchend",function(e){e.stopPropagation(),this.classList.remove(t.ACTIVE)})})}});