!function(e,n){!function(){"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1)}(),window.onload=function(){setTimeout(function(){var n=document.querySelector("[talqs-app]");n&&(n.innerHTML=e.render(question,{hideSource:!0,hideDifficulty:!0,labels:{answer:"答案：",analyze:"解析："}}),setTimeout(function(){e.autoLayout()},100)),[].forEach.call(document.images,function(e){if(!e.complete){var n=e.getAttribute("width")||120,t=e.getAttribute("height")||90,a=-1!==e.parentElement.className.indexOf("talqs_img_loader")?e.parentElement:null,i=function(){a&&(a.classList.remove("loading"),a.setAttribute("style",""))},r=function(){a&&(a.setAttribute("style","width:"+n+"px; height:"+t+"px"),a.classList.add("loading"))};r(),e.onerror=function(e){if(console.log(e),!this.loadDefault){i();var n=this.src;this.src="load-failed.png",this.loadDefault=!0,this.onclick=function(){r(),this.src=n,this.loadDefault=!1}}},e.onload=function(){i()}}})},0)},function(e){if(window.WebViewJavascriptBridge)return e(WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var n=document.createElement("iframe");n.style.display="none",n.src="wvjbscheme://__BRIDGE_LOADED__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)},0)}(function(t){function a(e){var n='[data-que-id="'+e+'"]';return document.querySelector(n)}function i(e){var n=document.createElement("div");return n.className=e||"",n}function r(n,t,a,r){var l=t.querySelector("."+c.analyzeLayer);if(parseInt(r,10)){if(!l){var o=i(c.analyzeGroup);t.appendChild(o),l=i(c.analyzeLayer),o.appendChild(l)}l.insertAdjacentHTML("beforeend",e.renderPartialComponent(n.component,a))}else if(l){var d=l.querySelector(s[n.key]);d&&l.removeChild(d),l.children.length||t.removeChild(l.parentNode)}}function l(e,n){var t='[data-option-item="'+e+'"] [data-option-content]',a=n.querySelector(t);return a||(t='[data-current-option="'+e+'"]',a=n.querySelector(t)),a&&a.textContent||""}function o(e,n){var t=a(n.queId);if(t){var o=t.querySelectorAll(s.optionAnalyze),d=n.state,u=o.length>0,p=t.querySelector(s.analyzeContainer);if(u||p){var f=e.key,h=[];h=e.isAnalysis?n.analysis.map(function(e){return[e]}):p?n.answer.map(function(e){var n=e[0];return[n+"（"+l(n,t)+"）"]}):n.answer;var g=function(n,t){var a={};a[f]=h[n],r(e,t,a,d)};if(u)[].forEach.call(o,function(e,n){g(n,e.parentNode)});else{var v=t.querySelectorAll(s.optionList),m=v.length-1;v[m].classList.add("hidden"),p.style.display="block",h.forEach(function(e,n){var t=p.children[n];if(!t){t=i();var a=document.createElement("span");a.className=c.analyzeIndex,a.innerText=n+1+".",t.appendChild(a),p.appendChild(t)}g(n,t)}),p.querySelector(s.answer)||p.querySelector(s.analysis)||(p.innerHTML="",v[m].classList.remove("hidden"),p.style.display="none")}}else r(e,t,n,d)}}var c={analyzeGroup:"talqs_analyze_group",analyzeLayer:"talqs_analyze_layer",feedbackNote:"talqs_remind",feedbackSuccess:"talqs_remind_clicked",imgAll:"talqs_img_all",process:"talqs_correct_process",imgWrap:"talqs_img_wrap",imgDesc:"talqs_img_time",loading:"talqs_img_loading",fail:"talqs_img_fail",analyzeIndex:"talqs_analyze_index"},s={optionAnalyze:'[data-option-analyze="1"]',answer:".talqs_answer",analysis:".talqs_analyze",imgContainer:".talqs_img_container",optionAnalyzeContainer:".talqs_options_analyze",analyzeContainer:".talqs_analysis_container",optionList:".talqs_options_list"},d={answer:{component:"questionAnswer",key:"answer"},analyze:{component:"questionAnalyze",key:"analysis",isAnalysis:!0}};t.registerHandler("toggleAnswer",function(e){Array.isArray(e)&&e.forEach(function(e){o(d.answer,e)})}),t.registerHandler("toggleAnalyze",function(e){Array.isArray(e)&&e.forEach(function(e){o(d.analyze,e)})}),t.registerHandler("toggleInteraction",function(e){n.toggleInteraction(e)}),t.registerHandler("togglePlayer",function(e){var n=e.url,t=1===e.state,a=document.querySelector('[url="'+n+'"] .audio_state');a&&a.classList.toggle("audio_playing",t)});var u=function(e){t.callHandler("userOperationPlayAudioCallBack",e)},p=function(e){t.callHandler("userOperationPlayVideoCallBack",e)},f=function(e){t.callHandler("userOperationGetMoreImageCallBack",null,function(n){e(n)})},h=function(e,n){e.parentNode&&e.parentNode.removeChild(e),n.onload=null,setTimeout(function(){n.style.display="block"},0)},g=function(e,n,t){var a=document.createElement(e);return a.className=n||"",a.textContent=t||"",a},v=function(e){var n=i("teacher_info"),t=g("img","teacher_avatar");t.style.display="none",t.onerror=function(){t.src="defaultAvatar.png"},t.onload=function(){t.style.display=""},t.src=e.avatar,n.appendChild(t);var a=g("span","teacher_name",e.teacherName);return n.appendChild(a),n},m=function(e){var n=i("text_wrapper"),t=v(e);n.appendChild(t);var a=g("div","text_content popover"),r=g("p","",e.content);return a.appendChild(r),n.appendChild(a),n},y=function(e){var n=i("audio_wrapper"),t=v(e);n.appendChild(t);var a=i("player_container"),r=g("div","audio_player audio_popover");r.setAttribute("url",e.url),a.appendChild(r);var l=g("span","audio_state");r.appendChild(l),r.onclick=function(){u(e.url)};var o=g("span","audio_duration",e.duration);return a.appendChild(o),n.appendChild(a),n},C=function(e,n,t){var a=i(c.imgWrap),r=i(c.loading);a.appendChild(r);var l=new Image;l.style.display="none",a.appendChild(l);var o=function(){h(r,l),n()};if(l.onload=o,l.onerror=function(){o();var e=this.src;this.src="img-fail.png",this.onclick=function(){this.src=e}},l.src=e.url,"video"===t){var s=g("span","talqs_video_play");a.appendChild(s),s.onclick=function(){p(e.videoUrl)}}if(e.desc){var d=g("span",c.imgDesc,e.desc);a.appendChild(d)}if(e.process){var d=g("span",c.process+e.process.state,e.process.text);a.appendChild(d)}return a},_=function(e,n){var t=i("talqs_result_item");if(e.text&&e.text.length){var a=i();e.text.forEach(function(e){a.appendChild(m(e))}),t.appendChild(a)}if(e.audio&&e.audio.length){var r=i();e.audio.forEach(function(e){r.appendChild(y(e))}),t.appendChild(r)}if(e.video&&e.video.length){var l=i("talqs_video_wrapper");e.video.forEach(function(e){l.appendChild(C(e,n,"video"))}),t.appendChild(l)}if(e.url){var o=C(e,n);t.appendChild(o)}if(e.errorDesc&&e.errorDesc.length){var c=g("p","talqs_error_desc","错误原因："+e.errorDesc.join("、"));t.appendChild(c)}return t},q=function(e){return[].filter.call(e,function(e){return-1!==e.className.indexOf("talqs_img_container")})[0]};t.registerHandler("setUserAnswer",function(e){var t,i=[],r=[],l=c.imgAll;e.forEach(function(e){e.data&&e.data.length&&r.push(e),e.img&&e.img.length&&i.push(e)}),n.setData(r);var o=function(e){var n=a(e.queId);if(n){var i=q(n.children);i.classList.remove(l),i.innerHTML="";var r,o,c=e.img.length,s=c<10,d=!1,u=0,p=!0,h=function(){var n=e.img.length;d=0===n;var t;if(!d){t=e.img.splice(0,Math.min(n,2)),u=0,p=!0;var a=t.length;t.forEach(function(e){var n=_(e,function(){u++,p=!(u===a)});i.insertBefore(n,r||null)}),o=r?r.previousElementSibling:i.lastElementChild}};if(h(),c>1){var v=function(n){if(!p)return d&&s?void m.removeEventListener("scroll",v):void(n.target.scrollTop+t>=o.offsetTop&&(d?(p=!0,f(function(n){p=!1,e.img=n||[],s=n.length<10,h()})):h()))},m=n.parentElement,y=!1,C=g("button","","查看更多");i.appendChild(C),r=C,C.addEventListener("click",function(){y=!y,i.classList.toggle(l,y),C.innerText=y?"收起":"查看更多",t||(t=document.getElementById("app").offsetHeight),m.addEventListener("scroll",v)})}}};i.forEach(function(e){o(e)})}),t.registerHandler("toggleCorrectFeedBack",function(e){e.forEach(function(e){var n=a(e.queId);if(n){var i=n.querySelector(".correct_feedback");if(e.state){i||(i=g("div","correct_feedback")),i.innerHTML="";var r=g("p","feedback_content",e.content||"");i.appendChild(r);var l=function(e){var n=g("p","feedback_result",e);i.appendChild(n)};if(e.options&&e.options.length){var o=g("ul","feedback_option");e.options.forEach(function(n){var a=g("li","feedback_option_item "+n.style||"",n.text);o.appendChild(a),a.onclick=function(){t.callHandler("userCorrectFeedBackCallback",{queId:e.queId,value:n.value},function(e){l(e),i.removeChild(o)})}}),i.appendChild(o)}e.result&&l(e.result);var c=q(n.children),s=c&&c.nextElementSibling||null;n.insertBefore(i,s)}else i&&n.removeChild(i)}})}),t.registerHandler("dispose",function(){var e=document.querySelectorAll("audio"),n=document.querySelectorAll("video"),t=function(e){e.pause()};[].forEach.call(e,t),[].forEach.call(n,t)}),t.registerHandler("toggleFeedback",function(e){Array.isArray(e)&&e.forEach(function(e){var n=a(e.queId);if(n){var i,r=n.querySelector(s.optionAnalyze),l=n.querySelector(s.analyzeContainer);if(l)i=l;else if(r){var o=r.parentNode.querySelector(s.analysis);!o&&e.state||(i=n.querySelector(s.optionAnalyzeContainer))}else i=n.querySelector(s.analysis);if(i){var d=i.querySelector("."+c.feedbackNote);if(e.state){d||(d=g("div",c.feedbackNote),i.appendChild(d)),d.innerText=e.note;var u=1===e.enable;d.classList.toggle(c.feedbackSuccess,!u),d.onclick=u?function(){t.callHandler("userFeedBackCallback",{queId:e.queId,enable:e.enable})}:null}else d&&i.removeChild(d)}}})});var k,b=!0,A=function(e){if(e)for(;e.parentNode;)if(e=e.parentNode,/talqs_content/.test(e.className))return e.getAttribute("id");return null},E=function(){var e="";k.highlights&&k.highlights.length&&(e=k.serialize()),t.callHandler("userHighlightCallback",e)},w=function(e){t.callHandler("showUnmarkAlertCallback",null,function(n){n&&e&&e()})},H=function(e){if(k)if(e)k.deserialize(e);else{var n=rangy.getSelection();if(n.isCollapsed)return;n.expand("word",{trim:!0}),n=rangy.getSelection();var t=A(n.focusNode);t&&k.highlightSelection("highlight",{containerElementId:t}),E()}},S=function(e){!k&&rangy&&(rangy.init(),k=rangy.createHighlighter(),k.addClassApplier(rangy.createClassApplier("highlight",{ignoreWhiteSpace:!0,tagNames:["span"],elementProperties:{onclick:function(){if(!b){var e=k.getHighlightForElement(this);return w(function(){k.removeHighlights([e]),E()}),!1}}}}))),H(e)};t.registerHandler("highlight",function(e){S(e)}),t.registerHandler("removeAllHighlights",function(){k&&k.removeAllHighlights()}),t.registerHandler("toggleHighlight",function(e){var n=document.getElementById("app");n&&n.classList.toggle("selection",1===e),b=0===e}),n.onChange=function(e){t.callHandler("userOperationCallback",e)}})}(TalqsTemplate,TalqsInteraction);